<!DOCTYPE html><html><head>
      <title>「AntV」X6开发实践：踩过的坑与解决方案（总）</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
      
      
      
      
      
      <style>
      code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    // your code here
  });
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/2578582/1702520774692-4d5ee4a2-648f-43b3-ac05-b824d6eec961.png#averageHue=%23463a57&amp;clientId=u55942578-5ff7-4&amp;from=paste&amp;height=269&amp;id=u194edfe1&amp;originHeight=708&amp;originWidth=724&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=249605&amp;status=done&amp;style=none&amp;taskId=uf300d479-9911-484c-9eb5-2047655a16e&amp;title=&amp;width=274.6625061035156" alt="original.png"></p>
<h2 id="️--如何自定义拖拽源">🖼️ | 如何自定义拖拽源？ </h2>
<blockquote>
<p>相信你们在开发中更多的需求是需要自定义拖拽源，毕竟自定义的功能扩展性高一些，而且可以根据你的业务需求灵活设置。自定义拖拽的优点就是：万物皆可成为拖拽源，不管你使用的是html标签，还是第三方的ui框架，或者树形列表，……这些都可以设置成拖拽源，只有你想不到的，没有官方做不到的，来吧，开整。</p>
</blockquote>
<p>在线体验（国内镜像）：<a href="https://sxdpanda.gitee.io/antv-admin/#/antv/demo">https://sxdpanda.gitee.io/antv-admin/#/antv/demo</a> （gitee的pages服务凉凉了）<br>
在线体验（备用地址）：<a href="https://zlecheng.github.io/antv-page/#/home">https://zlecheng.github.io/antv-page/#/home</a></p>
<h4 id="官方提供的拖拽">官方提供的拖拽 </h4>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/2578582/1685152369288-f5e295ee-44cc-4b0b-aa0b-0856a0701222.png#averageHue=%23bcdeb7&amp;clientId=u7af71f20-93b4-4&amp;from=paste&amp;height=194&amp;id=uec051bc4&amp;originHeight=381&amp;originWidth=623&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=17042&amp;status=done&amp;style=none&amp;taskId=ub63ed74d-1960-4c2c-bb90-a5ae185b0b9&amp;title=&amp;width=316.66668701171875" alt="image.png"></p>
<h4 id="自定义的拖拽">自定义的拖拽 </h4>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/2578582/1686287334152-72d8d796-12a0-4562-afca-0156d10f099a.png#averageHue=%23fcfcfb&amp;clientId=u81e86784-6629-4&amp;from=paste&amp;height=198&amp;id=u0df6d612&amp;originHeight=579&amp;originWidth=1095&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=71322&amp;status=done&amp;style=none&amp;taskId=uc9327906-0a2d-4b62-8cba-42b71da9033&amp;title=&amp;width=374.66668701171875" alt="image.png"></p>
<h3 id="解决方案">解决方案 </h3>
<blockquote>
<p>这里使用的是<a href="https://x6.antv.antgroup.com/tutorial/plugins/dnd">Dnd插件</a>，因为我看官方介绍说<a href="https://x6.antv.antgroup.com/tutorial/plugins/stencil">Stencil</a>插件内部也是依靠Dnd实现的，索性就直接使用Dnd来搞吧</p>
</blockquote>
<h4 id="步骤1初始化dnd">步骤1：初始化Dnd </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 全局graph变量</span>
<span class="token keyword keyword-let">let</span> graph <span class="token operator">=</span> <span class="token keyword null nil keyword-null">null</span><span class="token punctuation">;</span>
<span class="token comment">// 先定义个全局的dnd变量</span>
<span class="token keyword keyword-let">let</span> dnd <span class="token operator">=</span> <span class="token keyword null nil keyword-null">null</span><span class="token punctuation">;</span>
<span class="token comment">// 在mounted中对dnd进行初始化（在graph之后初始化）</span>
graph <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Graph</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">container</span><span class="token operator">:</span> proxy<span class="token punctuation">.</span><span class="token property-access">$refs</span><span class="token punctuation">.</span><span class="token property-access">container</span><span class="token punctuation">,</span>
  <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token string">'100%'</span><span class="token punctuation">,</span>
  <span class="token spread operator">...</span>tempConfig  <span class="token comment">// 这个是我的画布配置</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dnd <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Dnd</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">target</span><span class="token operator">:</span> graph<span class="token punctuation">,</span>
  <span class="token literal-property property">scaled</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token literal-property property">dndContainer</span><span class="token operator">:</span> proxy<span class="token punctuation">.</span><span class="token property-access">$refs</span><span class="token punctuation">.</span><span class="token property-access">dndContainer</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h4 id="步骤2定义拖拽事件">步骤2：定义拖拽事件 </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token doc-comment comment">/**
 * 自定义拖拽源事件
 * <span class="token keyword keyword-@param">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">e</span>
 * <span class="token keyword keyword-@param">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">treeNode</span> 根据需要传入要添加的参数
 * <span class="token keyword keyword-@param">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">data</span> 根据需要传入要添加的参数
 * 这里使用的是elementPlus的tree组件
 */</span>
<span class="token keyword keyword-const">const</span> <span class="token function-variable function">startDrag</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span> treeNode<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'eee'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'treeNode'</span><span class="token punctuation">,</span> treeNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> node <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token method function property-access">createNode</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">shape</span><span class="token operator">:</span> <span class="token string">'cu-data-node'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">150</span><span class="token punctuation">,</span>
    <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">104</span><span class="token punctuation">,</span>
    <span class="token literal-property property">label</span><span class="token operator">:</span> data<span class="token operator">?.</span>label<span class="token punctuation">,</span>
	<span class="token comment">// 传递给自定义节点的数据</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">label</span><span class="token operator">:</span> data<span class="token operator">?.</span>label<span class="token punctuation">,</span>
      <span class="token literal-property property">img</span><span class="token operator">:</span> data<span class="token operator">?.</span>img<span class="token punctuation">,</span>
      <span class="token literal-property property">desc</span><span class="token operator">:</span> data<span class="token operator">?.</span>desc
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">ports</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token spread operator">...</span>port<span class="token punctuation">,</span>
      <span class="token literal-property property">items</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token string">'top'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  dnd<span class="token punctuation">.</span><span class="token method function property-access">start</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><h4 id="步骤3自定义html节点">步骤3：自定义html节点 </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code>  <span class="token comment">// 注册自定义节点 图标+标题+描述</span>
  <span class="token maybe-class-name">Shape</span><span class="token punctuation">.</span><span class="token constant">HTML</span><span class="token punctuation">.</span><span class="token method function property-access">register</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">shape</span><span class="token operator">:</span> <span class="token string">'cu-data-node'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token string">'auto'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">104</span><span class="token punctuation">,</span>
    <span class="token literal-property property">effect</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token function">html</span><span class="token punctuation">(</span><span class="token parameter">cell</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 获取节点传递过来的数据</span>
      <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> label<span class="token punctuation">,</span> img<span class="token punctuation">,</span> desc <span class="token punctuation">}</span> <span class="token operator">=</span> cell<span class="token punctuation">.</span><span class="token method function property-access">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 创建自定义的节点容器</span>
      <span class="token keyword keyword-const">const</span> container <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      container<span class="token punctuation">.</span><span class="token method function property-access">setAttribute</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'cu-container'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 图片根据不同的类型进行切换，可以是后端返回的图标，也可以是自己本地的图标，如果是后端返回就通过节点的data传进来</span>
      <span class="token keyword keyword-const">const</span> container_img <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      container_img<span class="token punctuation">.</span><span class="token property-access">src</span> <span class="token operator">=</span> currentTab<span class="token punctuation">.</span><span class="token property-access">value</span> <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token string">'/src/assets/images/operator/datasouce.png'</span> <span class="token operator">:</span> img<span class="token punctuation">;</span>
      container_img<span class="token punctuation">.</span><span class="token method function property-access">setAttribute</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'cu-container-img'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


      <span class="token keyword keyword-const">const</span> container_title <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      container_title<span class="token punctuation">.</span><span class="token property-access">innerText</span> <span class="token operator">=</span> label<span class="token punctuation">;</span>
      container_title<span class="token punctuation">.</span><span class="token method function property-access">setAttribute</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'cu-container-title'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


      <span class="token keyword keyword-const">const</span> container_desc <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      container_desc<span class="token punctuation">.</span><span class="token method function property-access">setAttribute</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'cu-container-desc'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      container_desc<span class="token punctuation">.</span><span class="token property-access">innerText</span> <span class="token operator">=</span> desc <span class="token operator">||</span> <span class="token string">'描述信息'</span><span class="token punctuation">;</span>


      container<span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span>container_img<span class="token punctuation">)</span><span class="token punctuation">;</span>
      container<span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span>container_title<span class="token punctuation">)</span><span class="token punctuation">;</span>
      container<span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span>container_desc<span class="token punctuation">)</span><span class="token punctuation">;</span>


      <span class="token keyword control-flow keyword-return">return</span> container<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h4 id="步骤4元素绑定拖拽事件">步骤4：元素绑定拖拽事件 </h4>
<pre data-role="codeBlock" data-info="html" class="language-html html"><code><span class="token comment">&lt;!-- $event必传，后面的参数根据你的业务需求动态添加 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>  <span class="token attr-name">@mousedown</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>startDrag($event, node, data)<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>拖拽的节点<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><hr>
<h2 id="️--框选完成后添加右键菜单">🖼️ | 框选完成后添加右键菜单？ </h2>
<blockquote>
<p>今天在群里有个小伙伴提出了这么个问题：如何在框选完成后给框选的区域添加一个右键菜单的功能，我看到了这个问题后也是有点懵，心里想着怎么还有这个需求，直接快捷键删除不是更好吗，谁知这位小伙伴也是这么写的，奈何客户要添加右键菜单的功能，所以说，客户最大。既然人家都提出这个需求呢，那就说明大概率情况下是可以做的，只是看自己想不想做了，下面我先来分析下我的思路，仅供参考，不过这个方案应该是能解决大部分的业务场景了</p>
</blockquote>
<h3 id="问题分析">问题分析 </h3>
<ol>
<li>框选完成？那就监听框选完成的事件，这个官方是有对应的事件的</li>
<li>框选完成才会触发右键？也就是说不框选是不能触发右键事件的</li>
<li>即使前面两个步骤都解决了，那我这个菜单坐标怎么确定？第一个想到是框选的时候会有左右的边界，就像如图这样，我是否可以根据这两个边界节点的坐标去动态计算？第二个方法就是不加右键的功能，直接在框选的容器的右上角添加一个dom，把操作按钮放在这里面，通过鼠标划入来控制显示和隐藏</li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/2578582/1687353577433-76cd22ea-8c7d-49bc-b266-891a12c1b1d1.png#averageHue=%23fcf8f6&amp;clientId=ucaca3209-d030-4&amp;from=paste&amp;height=325&amp;id=u52019b66&amp;originHeight=325&amp;originWidth=581&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=24065&amp;status=done&amp;style=none&amp;taskId=uc74c9fec-efa1-4ffa-a180-19847d0e2bb&amp;title=&amp;width=581" alt="image.png"></p>
<ol start="4">
<li>但是从全局的角度分析了下，发现第三个步骤复杂度有点大，不是说不能实现，而是没有必要这么做；就像你去跑800米，正常情况下我们都是贴着最内道跑，而你非要在最外道跑。而且没有添加右键这个操作，不就满足不了需求了吗。</li>
<li>经过一轮分析后，决定还是来玩玩dom操作，因为只有dom是一直不变的，变的只是显示隐藏而已，从理论上来说，我们是可以获取到框选这个容器的dom实例的，然后再根据这个dom实例去触发右键的事件，然后我在这个右键里面添加我的业务操作不就行了吗？开干吧！</li>
</ol>
<h3 id="解决方法">解决方法 </h3>
<h4 id="步骤1">步骤1 </h4>
<p>这里为了保险起见，我给框选插件的配置项添加了一个自定义的class类名，我可以根据我这个唯一的class去获取框选的容器<br>
<img src="https://cdn.nlark.com/yuque/0/2023/png/2578582/1687353742608-5f759ac8-1e7c-44d0-b7c0-26fc56b4e044.png#averageHue=%23252931&amp;clientId=ucaca3209-d030-4&amp;from=paste&amp;height=175&amp;id=uc6f19fee&amp;originHeight=175&amp;originWidth=415&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=true&amp;size=9205&amp;status=done&amp;style=none&amp;taskId=ud5c51f1f-b75f-456b-a28f-9b48610b847&amp;title=%E9%85%8D%E7%BD%AE%E9%A1%B9%E5%8F%82%E8%80%83&amp;width=415" alt="配置项参考" title="配置项参考"></p>
<h4 id="步骤二">步骤二 </h4>
<p>开始玩dom，先获取到我自定义的这个class，然后再根据这个父级去获取真正的框选容器（框选容器的class需要自行打开浏览器的f12去找哈）</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 我自定义的class</span>
<span class="token keyword keyword-const">const</span> parent <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">'cu-selected-container'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// 框选的容器</span>
<span class="token keyword keyword-const">const</span> selectInner <span class="token operator">=</span> parent<span class="token punctuation">.</span><span class="token method function property-access">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">'x6-widget-selection-inner'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// 打印下看是个啥</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'seleeeee &gt;&gt;&gt;'</span><span class="token punctuation">,</span> selectInner<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>没错了，我获取到了，看下图<br>
<img src="https://cdn.nlark.com/yuque/0/2023/png/2578582/1687354009696-1dd9ec92-4b14-4a73-95d3-c4620ae2c506.png#averageHue=%232d333b&amp;clientId=ucaca3209-d030-4&amp;from=paste&amp;height=82&amp;id=u2dc6078e&amp;originHeight=82&amp;originWidth=629&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=10480&amp;status=done&amp;style=none&amp;taskId=u210f4b84-f4d9-4170-a29c-0fe6c223174&amp;title=&amp;width=629" alt="image.png"></p>
<h4 id="步骤三">步骤三 </h4>
<p>经过前面两个步骤的处理，步骤三就轻松多了，步骤三主要做的事情就是监听框选完成的事件，看过官网的小伙伴都知道，官方大大给我们提供的事件还是挺多的<a href="https://x6.antv.antgroup.com/tutorial/plugins/selection#%E9%85%8D%E7%BD%AE">事件</a>，那小伙伴在这里可能就犯嘀咕了，我到底该用哪个呢？其实吧，我觉得这里用哪个事件更多取决你的业务场景，我这里为了节约时间，就直接使用<code>selection:changed</code>这个事件了。<br>
:::warning<br>
Tip：如果你框选的节点个数是0的话需要特殊处理下，不然控制台会报框选的容器不存在，我这里是根据selected的长度进行判断，不满足条件直接提前返回<br>
:::</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code>graph<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'selection:changed'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> selected <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>selected<span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword control-flow keyword-return">return</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> parent <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">'cu-selected-container'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> selectInner <span class="token operator">=</span> parent<span class="token punctuation">.</span><span class="token method function property-access">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">'x6-widget-selection-inner'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  selectInner<span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">pointerEvents</span> <span class="token operator">=</span> <span class="token string">'unset'</span><span class="token punctuation">;</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'seleeeee &gt;&gt;&gt;'</span><span class="token punctuation">,</span> selectInner<span class="token punctuation">)</span><span class="token punctuation">;</span>
 selectInner<span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'contextmenu'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    event<span class="token punctuation">.</span><span class="token method function property-access">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>最后再看下效果吧，菜单的内容后面我再更新吧……<br>
<img src="https://cdn.nlark.com/yuque/0/2023/png/2578582/1687354818640-1738e628-0392-47f1-a891-49fca4937277.png#averageHue=%23e6e5e5&amp;clientId=ucaca3209-d030-4&amp;from=paste&amp;height=361&amp;id=ua99f3458&amp;originHeight=664&amp;originWidth=716&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=32021&amp;status=done&amp;style=none&amp;taskId=u258496bb-fe68-4f25-b13d-de084a65820&amp;title=&amp;width=389" alt="image.png"></p>
<h4 id="步骤四">步骤四 </h4>
<p>原以为到第三个步骤就结束了，没想到还有个问题，就是我一直去框选，但是这期间我不去触发右击事件，直到最后我再右键，这时你再去点击alert的确定按钮会发现完全关不掉，我想着完了完了，是不是进入死循环了？于是我就多实验了几次，发现这个alert的次数是和我框选的次数是有关联的，于是就在想是哪里除了问题，经过一番排查后发现是事件的问题，好像是每次框选完后没有清空掉dom，于是我就从事件这里下手解决，决定在触发右键菜单之前先移除一下右键的事件（排他法，不管你有没有，先清空再说），果然问题得到了完美的解决</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-const">const</span> <span class="token function-variable function">handleContextMenu</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  event<span class="token punctuation">.</span><span class="token method function property-access">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
graph<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'selection:changed'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> selected <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>selected<span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword control-flow keyword-return">return</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> parent <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">'cu-selected-container'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> selectInner <span class="token operator">=</span> parent<span class="token punctuation">.</span><span class="token method function property-access">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">'x6-widget-selection-inner'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  selectInner<span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">pointerEvents</span> <span class="token operator">=</span> <span class="token string">'unset'</span><span class="token punctuation">;</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'seleeeee &gt;&gt;&gt;'</span><span class="token punctuation">,</span> selectInner<span class="token punctuation">)</span><span class="token punctuation">;</span>
  selectInner<span class="token punctuation">.</span><span class="token method function property-access">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'contextmenu'</span><span class="token punctuation">,</span> handleContextMenu<span class="token punctuation">)</span><span class="token punctuation">;</span>
  selectInner<span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'contextmenu'</span><span class="token punctuation">,</span> handleContextMenu<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="总结">总结 </h3>
<p>问题分析很关键，代码只是个工具，具体怎么走还是要我们自己去制定，所以在这一行待的时间久了，你会发现分析问题和关键时刻解决问题的能力是有多重要。顺便讲一下这个小功能我也是趁着下班前15分钟搞出来的，如果我直接跳过分析问题的步骤，我估计到节后也不一定能想到解决方案。好了，这个小问题的总结就到这吧，有空再更新菜单坐标的问题的解决思路吧。😜demo也同步更新了，想看效果的可以直接看 <a href="https://sxdpanda.gitee.io/antv-admin/#/antv/demo">国内镜像</a> /  <a href="https://zlecheng.github.io/antv-page/#/home">备用地址</a></p>
<h2 id="️--点击节点清空框选的选区">🖼️ | 点击节点清空框选的选区 </h2>
<p>先看看问题图片，在点击节点的时候会出现这么个玩意，但是我想要的效果是点击的时候不显示，只有在框选的时候才会去显示选区<br>
<img src="https://cdn.nlark.com/yuque/0/2023/png/2578582/1687064700490-c5fe2402-04f2-4495-a0e7-ea57e66d3d38.png#averageHue=%237e7e7d&amp;clientId=u28121ce6-f5c8-4&amp;from=paste&amp;height=348&amp;id=u0fa13c10&amp;originHeight=348&amp;originWidth=463&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=9011&amp;status=done&amp;style=none&amp;taskId=u190dd9f8-b11d-429f-9ef1-b081d02a68e&amp;title=&amp;width=463" alt="image.png"></p>
<h3 id="解决方法-1">解决方法 </h3>
<p>点击节点的时候清空掉选择的选区，这这样子就没有问题了</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code>  graph<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'node:click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> node <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    graph<span class="token punctuation">.</span><span class="token method function property-access">cleanSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><hr>
<h2 id="️--使用键盘方向键控制节点的移动">🖼️ | 使用键盘方向键控制节点的移动 </h2>
<blockquote>
<p>首先需要了解的知识点是js的键盘事件，但是我们不能只考虑方向键的触发时机，还要考虑键盘是否是按下的状态</p>
</blockquote>
<h3 id="步骤1-1">步骤1 </h3>
<p>准备一个节点，在创建节点的时候把节点存储到一个全局变量中，方便后续获取节点的位置</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-let">let</span> testNode <span class="token operator">=</span> <span class="token keyword null nil keyword-null">null</span><span class="token punctuation">;</span>
  <span class="token comment">// 将节点添加到画布中</span>
  testNode <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token method function property-access">addNode</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">shape</span><span class="token operator">:</span> <span class="token string">"circle"</span><span class="token punctuation">,</span>
    <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
    <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
    <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
    <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
    <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">"矩形"</span><span class="token punctuation">,</span>
    <span class="token literal-property property">attrs</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">fill</span><span class="token operator">:</span> <span class="token string">"#fff"</span><span class="token punctuation">,</span>
        <span class="token literal-property property">stroke</span><span class="token operator">:</span> <span class="token string">"#007aff"</span><span class="token punctuation">,</span>
        <span class="token literal-property property">strokeWidth</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">refX</span><span class="token operator">:</span> <span class="token string">"0.5"</span><span class="token punctuation">,</span>
        <span class="token literal-property property">refY</span><span class="token operator">:</span> <span class="token string">"100%"</span><span class="token punctuation">,</span>
        <span class="token literal-property property">refY2</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
        <span class="token literal-property property">textAnchor</span><span class="token operator">:</span> <span class="token string">"middle"</span><span class="token punctuation">,</span>
        <span class="token literal-property property">textVerticalAnchor</span><span class="token operator">:</span> <span class="token string">"top"</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="步骤二-1">步骤二 </h3>
<p>准备一个开关按钮，用于开启节点的移动，如果不存在节点，那我们可以直接提前return；然后我们给键盘添加监听事件，判断四个方向键对应的keyCode，最后再通过<code>node.position()</code>这个api设置节点的移动步幅</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-const">const</span> <span class="token function-variable function">handleMove</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>testNode<span class="token punctuation">)</span> <span class="token keyword control-flow keyword-return">return</span><span class="token punctuation">;</span>
  <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">"keydown"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> keyCode <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token property-access">keyCode</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> position <span class="token operator">=</span> testNode<span class="token punctuation">.</span><span class="token method function property-access">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow keyword-switch">switch</span> <span class="token punctuation">(</span>keyCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword keyword-case">case</span> <span class="token number">37</span><span class="token operator">:</span> <span class="token comment">// left arrow</span>
        testNode<span class="token punctuation">.</span><span class="token method function property-access">position</span><span class="token punctuation">(</span>position<span class="token punctuation">.</span><span class="token property-access">x</span> <span class="token operator">-</span> <span class="token number">10</span><span class="token punctuation">,</span> position<span class="token punctuation">.</span><span class="token property-access">y</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword control-flow keyword-break">break</span><span class="token punctuation">;</span>
      <span class="token keyword keyword-case">case</span> <span class="token number">38</span><span class="token operator">:</span> <span class="token comment">// up arrow</span>
        testNode<span class="token punctuation">.</span><span class="token method function property-access">position</span><span class="token punctuation">(</span>position<span class="token punctuation">.</span><span class="token property-access">x</span><span class="token punctuation">,</span> position<span class="token punctuation">.</span><span class="token property-access">y</span> <span class="token operator">-</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword control-flow keyword-break">break</span><span class="token punctuation">;</span>
      <span class="token keyword keyword-case">case</span> <span class="token number">39</span><span class="token operator">:</span> <span class="token comment">// right arrow</span>
        testNode<span class="token punctuation">.</span><span class="token method function property-access">position</span><span class="token punctuation">(</span>position<span class="token punctuation">.</span><span class="token property-access">x</span> <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">,</span> position<span class="token punctuation">.</span><span class="token property-access">y</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword control-flow keyword-break">break</span><span class="token punctuation">;</span>
      <span class="token keyword keyword-case">case</span> <span class="token number">40</span><span class="token operator">:</span> <span class="token comment">// down arrow</span>
        testNode<span class="token punctuation">.</span><span class="token method function property-access">position</span><span class="token punctuation">(</span>position<span class="token punctuation">.</span><span class="token property-access">x</span><span class="token punctuation">,</span> position<span class="token punctuation">.</span><span class="token property-access">y</span> <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword control-flow keyword-break">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><hr>
<h2 id="️--自定义html节点鼠标移入范围问题">🖼️ | 自定义html节点鼠标移入范围问题 </h2>
<blockquote>
<p>今天在搞自定义拖拽和鼠标移入节点显示连接桩的时候，所有的步骤都是按照官网的demo来走的，代码也是全部复制的官网的，只有html节点那里是手动写的，这个东西本来如果不出错的话10来分钟就能写完了，谁知道就这个小东西竟然搞了我半个多小时，想想都气人……</p>
</blockquote>
<h3 id="场景">场景 </h3>
<blockquote>
<p>在鼠标移入节点的时候显示节点上的连接桩，鼠标离开节点就隐藏连接桩。但是我发现在鼠标移入节点下方（一直到画布可视区域内这段距离）都能触发鼠标移入事件。</p>
</blockquote>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/2578582/1686295776297-fcab0a10-db78-48d9-b85e-f234c4ccb0d7.png#averageHue=%23fcf5f4&amp;clientId=u5b3db1d9-5f41-4&amp;from=paste&amp;height=409&amp;id=u5383d9a9&amp;originHeight=613&amp;originWidth=322&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=13353&amp;status=done&amp;style=none&amp;taskId=u7f903004-80b5-4e95-8f8a-6471dce2d09&amp;title=&amp;width=214.66666666666666" alt="image.png"></p>
<h3 id="问题分析-1">问题分析 </h3>
<ul>
<li>自定义的html节点未设置宽高，组件默认就给了100%？，很显然我并没有犯这么低级的错误……</li>
<li>创建dom的问题？嗯，也不是……</li>
<li>官方bug？果然我通过审查元素发现了这个玩意，只要把它宽高的100%去掉就可以了,但是经过一番操作后，发现并不是这个问题导致的，好吧，找了个寂寞，继续找……</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/2578582/1686296057465-c412b702-4fe9-45c6-a1d9-fa885bc81442.png#averageHue=%232e2b2a&amp;clientId=u5b3db1d9-5f41-4&amp;from=paste&amp;height=166&amp;id=ud87d963e&amp;originHeight=249&amp;originWidth=744&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=44683&amp;status=done&amp;style=none&amp;taskId=uc676cb6d-4968-4cb4-a430-cec1ea6ee0a&amp;title=&amp;width=496" alt="image.png"></p>
<ul>
<li>样式问题：一定是我这个项目里面哪个样式影响到了x6，经过对全局样式的一行行删减，终于找到了问题所在，罪魁祸首竟然是vite，因为我这个项目是用vite创建的，所以里面的样式有一部分是vite创建的时候默认生成的，它把body的宽高都设置成固定值了，而且body的高度还是100vh，哎，真是服了这个老六了，藏得太深了</li>
</ul>
<h3 id="解决方法-2">解决方法 </h3>
<p>把body的宽高设置成100%就可以了</p>
<hr>
<h2 id="️--自定义边的label点击label触发边的点击事件问题">🖼️ | 自定义边的label，点击label触发边的点击事件问题 </h2>
<blockquote>
<p>一般情况下，出现这种问题基本上是因为事件冒泡导致的，所以这个问题的解决方法也显而易见，阻止事件传播就行了</p>
</blockquote>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/2578582/1686878699218-82235f64-093a-4670-bdc6-91cc221a6040.png#averageHue=%23fdfbf8&amp;clientId=ucd1721ea-30c5-4&amp;from=paste&amp;height=190&amp;id=u780ab455&amp;originHeight=285&amp;originWidth=677&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=13044&amp;status=done&amp;style=none&amp;taskId=u324ee651-ad7b-4fab-b7fd-3ffd5e64268&amp;title=&amp;width=451.3333333333333" alt="image.png"></p>
<h3 id="解决方法-3">解决方法 </h3>
<p><a href="https://antv-x6.gitee.io/zh/docs/tutorial/intermediate/events/#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%82%B9%E5%87%BB%E4%BA%8B%E4%BB%B6">事件系统</a><br>
<a href="https://x6.antv.antgroup.com/examples/edge/label/#render-with-html">demo</a></p>
<ul>
<li>给边添加自定义点击事件</li>
</ul>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code>graph<span class="token punctuation">.</span><span class="token method function property-access">addEdge</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
     <span class="token literal-property property">event</span><span class="token operator">:</span> <span class="token string">"edge:click"</span><span class="token punctuation">,</span>
     ……
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><ul>
<li>监听自定义点击事件，阻止事件传播</li>
</ul>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code>graph<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">"edge:customevent"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> name<span class="token punctuation">,</span> view<span class="token punctuation">,</span> e <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>name <span class="token operator">===</span> <span class="token string">"edge:click"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token method function property-access">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>好了，到这里的话说明我们已经成功阻止事件传播了，在点击label的时候就不会再触发边的点击事件了</p>
<hr>
<h2 id="️--本地图片导出后不显示">🖼️ | 本地图片导出后不显示？ </h2>
<p>先看看官方的导出文档：<br>
<a href="https://x6.antv.antgroup.com/tutorial/plugins/export">图片导出</a></p>
<blockquote>
<p>由于业务需要，需要把画布上的节点保存成图片供其它模块展示，如果你的后端返回的数据格式是前端想要的，那么大不必搞图片的形式，直接把官网的快速上手代码拿过来循环一下就好了……，这里就拿<code>toPng</code>的方法来讲解</p>
</blockquote>
<h3 id="问题梳理">问题梳理 </h3>
<ul>
<li>调用<code>toPng</code>拿到画布的base64数据</li>
<li>把base64的数据传给后端</li>
<li>后端把base64的数据转存后生成可访问的图片地址再返回给前端</li>
<li>前端开始展示</li>
</ul>
<blockquote>
<p>然而事情却没有这么简单，第一步就遇到了一堆的坑，由于官网上导出的都是它内置的节点，所以导出都没啥问题，但是我使用的是html节点，导出的时候，我节点的图片就死活导不出来，而且导出的样式也是乱的(<a href="https://antv-x6.gitee.io/zh/docs/tutorial/epilog#%E5%AF%BC%E5%87%BA%E5%9B%BE%E7%89%87%E6%A0%B7%E5%BC%8F%E7%BC%BA%E5%A4%B1">样式错乱问题</a>)</p>
</blockquote>
<h3 id="解决方案-1">解决方案 </h3>
<p>一句话：图片必须得是<strong>base64</strong>格式的导出才会有图片，不然无法导出节点的图片</p>
<ol>
<li>自定义html节点中把图片转换成base格式的</li>
</ol>
<blockquote>
<p>需要调用 imageToDataUri把图片地址转成base64的数据，这个方法我也是摸索了好久才找到的，官方文档完全没有提及这个方法，如果需要查看其它方法，请打印 <code>DataUri</code>这个对象</p>
</blockquote>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token maybe-class-name">DataUri</span><span class="token punctuation">.</span><span class="token method function property-access">imageToDataUri</span><span class="token punctuation">(</span><span class="token string">'/images/operator/datasouce.png'</span><span class="token punctuation">,</span>
  <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter">nu<span class="token punctuation">,</span> url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 第一个参数无效，用的只是第二个参数，但是第一个参数不写不行</span>
    container_img<span class="token punctuation">.</span><span class="token property-access">src</span> <span class="token operator">=</span> url<span class="token punctuation">;</span> <span class="token comment">// 给图片标签赋值</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><ol start="2">
<li>调用<code>toPng</code>生成base64数据</li>
</ol>
<blockquote>
<p>这个步骤中要处理的问题：导出后样式不正确，导出的时候页面闪动</p>
</blockquote>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code>graph<span class="token punctuation">.</span><span class="token method function property-access">toPNG</span><span class="token punctuation">(</span>
  <span class="token parameter">dataUri</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'dataUri &gt;&gt;&gt;&gt;'</span><span class="token punctuation">,</span> dataUri<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这个就是base的图片地址</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">526</span><span class="token punctuation">,</span>
    <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">268</span><span class="token punctuation">,</span>
    <span class="token literal-property property">backgroundColor</span><span class="token operator">:</span> <span class="token string">'rgba(25, 87, 121, 0.18)'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">quality</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 图片质量 取值范围：0-1，默认0.92</span>
    <span class="token comment">// copyStyles: false,</span>
    <span class="token comment">// 自定义样式表，为了解决导出后节点样式丢失的问题，暂时官方还没有修复这个bug</span>
    <span class="token literal-property property">stylesheet</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
      .cu-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      }
      .cu-container-title {
      color: #d3e6f3;
      }
      .cu-container-img {
      width: 53px;
      height: 53px;
      margin-bottom: 4px;
      }
      .cu-container-desc {
      color: rgba(211, 230, 243, 0.7);
      margin-top: 3px;
      }
      .cu-container-title,
      .cu-container-desc {
      font-size: 14px;
      font-weight: 400;
      line-height: 20px;
      display: -webkit-box;
      -webkit-box-orient: vertical;
      -webkit-line-clamp: 1;
      }
    </span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>:::warning<br>
Tip：图片导出样式和原节点的样式不一致问题：如果你遇到了这个问题，目前最好的方法是不断调整<code>stylesheet</code>中的样式，直到导出的样式和原节点的样式几乎一致即可。当然，如果你的甲方不重视页面交互，咱们完全可以使用<code>copyStyles:true</code>这个属性就行了，这样就不用设置 <code>stylesheet</code>了<br>
:::</p>
<hr>
<h2 id="️--神奇的图片边框">🖼️ | 神奇的图片边框 </h2>
<p>:::tips<br>
昨天才把html节点中的图片转成base格式的，今天就发现一个用户体验的问题；那么是啥呢？就是我从左侧的树形菜单中拖拽节点的时候（鼠标按下也是同样问题），发现节点的图片区域那里会出现一个边框，持续时间不是很长，就几毫秒的时间，但是当你连续拖拽几个不同节点的时候就会发现这个边框竟然又消失不见了，如果此时重新进入页面，再开始拖动节点，图片的边框又出现了。<br>
:::</p>
<h3 id="问题梳理-1">问题梳理 </h3>
<ul>
<li>是否是官方节点自带的边框？如果是，配置项是什么？</li>
<li>图片的默认边框是否被清除？还是外围元素的边框导致？</li>
<li>图片的加载时机？</li>
<li>是否是转base64的问题，毕竟在这之前没有这个情况发生……<br>
:::tips<br>
带着这些问题，第一时间去翻阅了官方文档，发现没有和这个问题相关的配置项，即使有设置了也不管用；然后就把问题抛到了交流群里面，发现压根没人回答……，那就只能开始第二个方案了：把图片的默认边框都去除掉，比如border，box-shadow，outline这些属性都去除掉了，发现还是没用；好吧，开始第三套方案：使用new Image处理图片的加载时机问题，嗯！不出意外的话，这个方法还是不行<br>
:::</li>
</ul>
<h3 id="定位问题">定位问题 </h3>
<blockquote>
<p>经过上面四个方案的尝试后，我大概知道了问题的源头在哪边了，那就是我自定义html节点中图片地址赋值的地方，由于<code>DataUri.imageToDataUri</code> 这个方法是个异步执行的，所以才会导致在渲染的时候会出现短暂的视觉差</p>
</blockquote>
<h3 id="解决方案-2">解决方案 </h3>
<ul>
<li>先给图片赋值个普通的地址（非base64的地址）</li>
<li>在<code>DataUri.imageToDataUri('随便写个参数名',url)</code>的回调中再把图片的src替换成base64的</li>
</ul>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-const">const</span> container_img <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
container_img<span class="token punctuation">.</span><span class="token method function property-access">setAttribute</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'cu-container-img'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
container_img<span class="token punctuation">.</span><span class="token method function property-access">setAttribute</span><span class="token punctuation">(</span><span class="token string">'alt'</span><span class="token punctuation">,</span> <span class="token string">'节点ico'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
container_img<span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">cursor</span> <span class="token operator">=</span> <span class="token string">'pointer'</span><span class="token punctuation">;</span>
<span class="token comment">// 先用远程图片地址给图片的src赋值，然后再重新赋值成base64的格式；这么做的目的就是解决节点拖拽到画布上会出现短暂的边框闪动问题，如果你要复现这个边框，可以把下面这一行代码注掉（不是必现）</span>
container_img<span class="token punctuation">.</span><span class="token property-access">src</span> <span class="token operator">=</span> img<span class="token punctuation">;</span>
<span class="token comment">// 把图片转成base64方便存储到后端</span>
<span class="token maybe-class-name">DataUri</span><span class="token punctuation">.</span><span class="token method function property-access">imageToDataUri</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter">nu<span class="token punctuation">,</span> url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">// 第一个参数无效，用的只是第二个参数，但是第一个参数不写由不行</span>
container_img<span class="token punctuation">.</span><span class="token property-access">src</span> <span class="token operator">=</span> url<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><hr>
<h2 id="️--画布内容从接口获取数据后无法居中">🖼️ | 画布内容从接口获取数据后无法居中？ </h2>
<h3 id="场景-1">场景 </h3>
<p>前端需要把画布上的节点保存到后端，然后前端在获取详情接口的时候要把节点进行居中处理</p>
<h3 id="问题梳理-2">问题梳理 </h3>
<p>在不调用后端接口的情况下使用<code>centerContent()</code>是没得问题的；但是在动态获取节点数据后就会存在异步加载的问题，也就是先将内容居中了，之后再设置节点到画布中去，此时<code>centerContent</code>的时机已经过去了，节点还是更具自身的位置进行排列</p>
<h3 id="解决方案-3">解决方案 </h3>
<blockquote>
<p>由于作者用的vue技术栈，所以这里的解决方法主要以vue为主</p>
</blockquote>
<p>方案1：使用<code>nextTick</code>等待dom全部渲染完成</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
	graph<span class="token punctuation">.</span><span class="token method function property-access">centerContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>方案2：直接在接口中使用</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token function">getDataView</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> item<span class="token punctuation">.</span><span class="token property-access">tableMetaName</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token property-access">code</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 缩放</span>
      graph<span class="token punctuation">.</span><span class="token method function property-access">zoom</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 画布居中</span>
      graph<span class="token punctuation">.</span><span class="token method function property-access">centerContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><hr>
<h2 id="️--自定义右键菜单坐标不准确">🖼️ | 自定义右键菜单坐标不准确？ </h2>
<h3 id="问题梳理-3">问题梳理 </h3>
<p>原本的写法是节点右键的时候通过<code>node.position()</code>的方法获取节点的坐标，然后再把节点的坐标绑到右键菜单的dom上，但是发现对画布进行平移的时候，右键菜单的位置还停留在第一次的位置，原因就是画布平移和节点没啥关系，节点的坐标并不会因为画布平移了就自动更改自身的坐标</p>
<h3 id="解决方案-4">解决方案 </h3>
<p><code>对鼠标的坐标进行转换</code>，这也是1.9版本中新增的一个方法，关键是在官方文档中还找不到这个方法，只能死马当活马医了 <a href="https://antv-x6.gitee.io/zh/docs/tutorial/log#19x">坐标转换</a>，果然问题解决了</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code>graph<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'node:contextmenu'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> e<span class="token punctuation">,</span> node <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> pos <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token method function property-access">clientToGraph</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">clientX</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token property-access">clientY</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 核心代码就是这一行</span>
  <span class="token function">createMenuDom</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> pos<span class="token punctuation">.</span><span class="token property-access">x</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> pos<span class="token punctuation">.</span><span class="token property-access">y</span><span class="token punctuation">,</span> node<span class="token punctuation">,</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="附自定义右键菜单完整代码">附：自定义右键菜单完整代码 </h3>
<p>这里需要对javascript的dom有点基础，不过这只是我创建dom的方法，如果你们想用其它的方法也是可以的哈</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-let">let</span> divMenuContainer <span class="token operator">=</span> <span class="token keyword null nil keyword-null">null</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> <span class="token function-variable function">createMenuDom</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> node<span class="token punctuation">,</span> edge<span class="token punctuation">,</span> type <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>divMenuContainer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果存在了菜单，就先移除再创建，不然你的页面上会多出来好多菜单的</span>
    <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">'container'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">removeChild</span><span class="token punctuation">(</span>divMenuContainer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  divMenuContainer <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  divMenuContainer<span class="token punctuation">.</span><span class="token method function property-access">setAttribute</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'div-menu-container'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  divMenuContainer<span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">left</span> <span class="token operator">=</span> x <span class="token operator">+</span> <span class="token number">30</span> <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span>
  divMenuContainer<span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">top</span> <span class="token operator">=</span> y <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> divMenuItem <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  divMenuItem<span class="token punctuation">.</span><span class="token method function property-access">setAttribute</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'div-menu-item'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  divMenuItem<span class="token punctuation">.</span><span class="token property-access">innerText</span> <span class="token operator">=</span> type <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token string">'删除节点'</span> <span class="token operator">:</span> <span class="token string">'删除边'</span><span class="token punctuation">;</span>
  divMenuItem<span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    type <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">?</span> graph<span class="token punctuation">.</span><span class="token method function property-access">removeNode</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span> <span class="token operator">:</span> graph<span class="token punctuation">.</span><span class="token method function property-access">removeEdge</span><span class="token punctuation">(</span>edge<span class="token punctuation">)</span><span class="token punctuation">;</span>
    divMenuContainer<span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">display</span> <span class="token operator">=</span> <span class="token string">'none'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  divMenuContainer<span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span>divMenuItem<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">'container'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span>divMenuContainer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>divMenuContainer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      divMenuContainer<span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">display</span> <span class="token operator">=</span> <span class="token string">'none'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code>graph<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'node:contextmenu'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> e<span class="token punctuation">,</span> node <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 坐标转换</span>
  <span class="token keyword keyword-const">const</span> pos <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token method function property-access">clientToGraph</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">clientX</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token property-access">clientY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 调用创建dom的方法，把坐标和节点信息传递进去</span>
  <span class="token function">createMenuDom</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">x</span><span class="token operator">:</span> pos<span class="token punctuation">.</span><span class="token property-access">x</span><span class="token punctuation">,</span> <span class="token literal-property property">y</span><span class="token operator">:</span> pos<span class="token punctuation">.</span><span class="token property-access">y</span><span class="token punctuation">,</span> node<span class="token punctuation">,</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h4 id="效果图">效果图 </h4>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/2578582/1686388439644-e839122d-00ac-4087-bb06-c359692dff6a.png#averageHue=%23faf9f8&amp;clientId=u36bc8a32-befd-4&amp;from=paste&amp;height=169&amp;id=u56d69601&amp;originHeight=253&amp;originWidth=370&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=11943&amp;status=done&amp;style=none&amp;taskId=u5b4ce435-38ca-40d3-b5ad-d6793fd7a45&amp;title=&amp;width=246.66666666666666" alt="image.png"></p>
<hr>
<h2 id="️--在历史记录中忽略某个属性的修改">🖼️ | 在历史记录中忽略某个属性的修改 </h2>
<p><a href="https://antv-x6.gitee.io/zh/docs/tutorial/epilog#%E5%9C%A8%E5%8E%86%E5%8F%B2%E8%AE%B0%E5%BD%95%E4%B8%AD%E5%BF%BD%E7%95%A5%E6%9F%90%E4%B8%AA%E5%B1%9E%E6%80%A7%E7%9A%84%E4%BF%AE%E6%94%B9">常见问题</a><br>
也是下面这个问题的解决方案<br>
<img src="https://cdn.nlark.com/yuque/0/2023/png/2578582/1685515952540-8cba3bd0-da00-49ef-994d-30cf22afbf4f.png#averageHue=%231d1c1c&amp;clientId=u21d263e6-84bc-4&amp;from=paste&amp;height=129&amp;id=uff262b18&amp;originHeight=185&amp;originWidth=1065&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=26820&amp;status=done&amp;style=none&amp;taskId=u278425e9-106c-48c9-a22d-b48d5b644a6&amp;title=&amp;width=742" alt="image.png"><br>
这是官方的demo<br>
<a href="https://codesandbox.io/s/lian-xian-undo-ybz995">连线 undo - CodeSandbox</a></p>
<h3 id="history插件配置">history插件配置 </h3>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-new">new</span> <span class="token class-name">Graph</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">history</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">enabled</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token function">beforeAddCommand</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> <span class="token literal-property property">args</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 忽略历史变更</span>
      <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span><span class="token property-access">options</span><span class="token punctuation">.</span><span class="token property-access">ignoreHistory</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow keyword-return">return</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><h3 id="边的写法">边的写法 </h3>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code>graph<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'edge:connected'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> edge <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token comment">// 传入自定义的 ignoreHistory 选项来忽略历史变更</span>
   edge<span class="token punctuation">.</span><span class="token method function property-access">attr</span><span class="token punctuation">(</span><span class="token string">'line/strokeDasharray'</span><span class="token punctuation">,</span> <span class="token keyword null nil keyword-null">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">ignoreHistory</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><h3 id="节点的写法">节点的写法 </h3>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-new">new</span> <span class="token class-name">History</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">enabled</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token function">beforeAddCommand</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span><span class="token property-access">options</span><span class="token punctuation">.</span><span class="token property-access">ignoreHistory</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow keyword-return">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
node<span class="token punctuation">.</span><span class="token method function property-access">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">tableMeta</span><span class="token operator">:</span> res<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">records</span><span class="token punctuation">,</span> <span class="token literal-property property">desc</span><span class="token operator">:</span> res<span class="token operator">?.</span>data<span class="token operator">?.</span>records<span class="token operator">?.</span>length <span class="token operator">||</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">ignoreHistory</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><hr>
<h2 id="️--x和y坐标为字符串报错问题">🖼️ | x和y坐标为字符串报错问题 </h2>
<h3 id="解决方案-5">解决方案 </h3>
<p>直接把x,y坐标转成纯数字的即可，不然拖动节点的时候会报错的</p>
<hr>
<h2 id="️--设置节点移动范围在画布内">🖼️ | 设置节点移动范围在画布内 </h2>
<p><a href="https://antv-x6.gitee.io/zh/docs/api/graph/transform/#translating">Transform</a></p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-new">new</span> <span class="token class-name">Graph</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">translating</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">restrict</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><h2 id="️--获取当前节点的所有父级节点">🖼️ | 获取当前节点的所有父级节点 </h2>
<blockquote>
<p>此方法会返回所有的输入和输出边，如果只要输入边的节点或者输出边的节点信息，请看这里<a href="https://antv-x6.gitee.io/zh/docs/api/graph/model/#getconnectededges">链接</a></p>
</blockquote>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-const">const</span> <span class="token function-variable function">getParentNodes</span> <span class="token operator">=</span> <span class="token parameter">node</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> nodeId <span class="token operator">=</span> node<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> connectedNodes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">// 如果需要其他方法，请看下方的具体配置，根据自己的需要修改这里的代码即可</span>
  <span class="token keyword keyword-const">const</span> edges <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token method function property-access">getConnectedEdges</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">deep</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-const">const</span> edge <span class="token keyword keyword-of">of</span> edges<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> sourceNode <span class="token operator">=</span> edge<span class="token punctuation">.</span><span class="token method function property-access">getSourceNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> targetNode <span class="token operator">=</span> edge<span class="token punctuation">.</span><span class="token method function property-access">getTargetNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>sourceNode<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">!==</span> nodeId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      connectedNodes<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span>sourceNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>targetNode<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">!==</span> nodeId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      connectedNodes<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span>targetNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow keyword-return">return</span> connectedNodes<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 具体的配置</span>
<span class="token keyword keyword-const">const</span> edges <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token method function property-access">getConnectedEdges</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span> <span class="token comment">// 返回输入和输出边</span>
<span class="token keyword keyword-const">const</span> edges <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token method function property-access">getConnectedEdges</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">incoming</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">outgoing</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 返回输入和输出边</span>

<span class="token keyword keyword-const">const</span> edges <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token method function property-access">getConnectedEdges</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">incoming</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 返回输入边</span>
<span class="token keyword keyword-const">const</span> edges <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token method function property-access">getConnectedEdges</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">incoming</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">outgoing</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 返回输入边</span>

<span class="token keyword keyword-const">const</span> edges <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token method function property-access">getConnectedEdges</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">outgoing</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 返回输出边</span>
<span class="token keyword keyword-const">const</span> edges <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token method function property-access">getConnectedEdges</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">incoming</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token literal-property property">outgoing</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 返回输出边</span>

<span class="token keyword keyword-const">const</span> edges <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token method function property-access">getConnectedEdges</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">deep</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 返回输入和输出边，包含链接到所有子孙节点/边的输入和输出边</span>
<span class="token keyword keyword-const">const</span> edges <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token method function property-access">getConnectedEdges</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">deep</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">incoming</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 返回输入边，包含链接到所有子孙节点/边的输入边</span>
<span class="token keyword keyword-const">const</span> edges <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token method function property-access">getConnectedEdges</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">deep</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">enclosed</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 返回输入和输出边，同时包含子孙节点/边之间相连的边</span>

<span class="token keyword keyword-const">const</span> edges <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token method function property-access">getConnectedEdges</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">indirect</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 返回输入和输出边，包含间接连接的边</span>
</code></pre><hr>
<h2 id="️--注册自定义节点报错">🖼️ | 注册自定义节点报错？ </h2>
<h3 id="报错信息">报错信息 </h3>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token punctuation">(</span><span class="token keyword keyword-in">in</span> promise<span class="token punctuation">)</span> <span class="token known-class-name class-name">Error</span><span class="token operator">:</span> <span class="token maybe-class-name">Node</span> <span class="token keyword keyword-with">with</span> name <span class="token string">'cu-port'</span> already registered<span class="token punctuation">.</span>
</code></pre><p>下面这个报错是群友发的，但是问题和我之前遇到的是一类问题，所以就直接告诉群友问题所在了😀<br>
<img src="https://cdn.nlark.com/yuque/0/2023/png/2578582/1685437902604-0e47dc85-ad6d-44d2-8280-e056fddffd28.png#averageHue=%238b8d8a&amp;clientId=ua6083450-d8a2-4&amp;from=paste&amp;height=335&amp;id=u13eae419&amp;originHeight=503&amp;originWidth=1345&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=755621&amp;status=done&amp;style=none&amp;taskId=u1060a3c2-cd9a-4cc5-8c63-d09d4c38a10&amp;title=&amp;width=896.6666666666666" alt="image.png"></p>
<h3 id="错误代码">错误代码 </h3>
<p><code>Graph.registerNode(name,options)</code></p>
<h3 id="正确代码">正确代码 </h3>
<p><code>Graph.registerNode(name,options,true)</code></p>
<hr>
<h2 id="️--删除边的时候获取边连接的节点数据">🖼️ | 删除边的时候，获取边连接的节点数据 </h2>
<p><a href="https://antv-x6.gitee.io/zh/docs/api/graph/model/#getsuccessors">getSuccessors</a><br>
<img src="https://cdn.nlark.com/yuque/0/2023/png/2578582/1686809412959-1f7e6193-1fb6-48d1-93c8-9fdc2a45f925.png#averageHue=%23fcf4f2&amp;clientId=ubba055f2-acab-4&amp;from=paste&amp;height=281&amp;id=u604d5c6b&amp;originHeight=421&amp;originWidth=1006&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=59888&amp;status=done&amp;style=none&amp;taskId=uebd7f37a-612d-4878-897d-f4bdce0c892&amp;title=&amp;width=670.6666666666666" alt="image.png"></p>
<h3 id="业务场景">业务场景 </h3>
<blockquote>
<p>现在画布上有5个节点，每个节点之间都有边进行相连，当我在删除第一个节点和第二个节点之间的边的时候，要获取到第二个节点的信息以及和第二个节点相连接的所有的子孙节点，包括直接或者间接连接的节点</p>
</blockquote>
<h3 id="问题梳理-4">问题梳理 </h3>
<blockquote>
<p>使用<code>getConnectedEdges</code>这个方法获取所有相连接的边，然后通过边的起始和结束字段去获取起始节点和结束节点，嗯，发现这个方法行不通；开始第二套方案：根据当前节点获取它的所有孩子节点，也就是<code>getChildren</code>这个方法，但是还不行，它只能获取到直接的子节点，间接的节点就获取不到了；继续第三套方案：去大海里捞针（在1.x的文档里面找到的一个api），<code>getSuccessors(node)</code>,嗯，挺好，这个可以获取了</p>
</blockquote>
<h3 id="代码示例">代码示例 </h3>
<ul>
<li>边被删除触发的事件</li>
</ul>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code>graph<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'edge:removed'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> edge <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><ul>
<li>根据边的sorce和target获取节点的数据</li>
</ul>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code>graph<span class="token punctuation">.</span><span class="token method function property-access">getCellById</span><span class="token punctuation">(</span>edge<span class="token operator">?.</span>target<span class="token operator">?.</span>cell<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><ul>
<li>根据node节点获取所有的子孙节点</li>
</ul>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code>graph<span class="token punctuation">.</span><span class="token method function property-access">getSuccessors</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><ul>
<li>完整代码</li>
</ul>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code>  <span class="token comment">// 边被删除的时候触发</span>
  graph<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'edge:removed'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> edge <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取边的结束节点信息 unshift</span>
    <span class="token keyword keyword-const">const</span> node <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token method function property-access">getCellById</span><span class="token punctuation">(</span>edge<span class="token operator">?.</span>target<span class="token operator">?.</span>cell<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 这里需要拦截下node的值是不是null，因为在删除节点的时候会同时删除边的，也就是说你不管是删除节点还是删除边，都会进这个方法的</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>node <span class="token operator">==</span> <span class="token keyword null nil keyword-null">null</span><span class="token punctuation">)</span> <span class="token keyword control-flow keyword-return">return</span><span class="token punctuation">;</span>
    <span class="token comment">// https://antv-x6.gitee.io/zh/docs/api/graph/model/#getsuccessors</span>
    <span class="token keyword keyword-let">let</span> childNodes <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token method function property-access">getSuccessors</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 这里把本身的节点也添加进去，如果不需要就不用push了，直接使用childNodes就行了</span>
    childNodes<span class="token punctuation">.</span><span class="token method function property-access">unshift</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'子孙节点不包含本身 &gt;&gt;&gt;'</span><span class="token punctuation">,</span> childNodes<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><hr>
<h2 id="️--去除边的箭头">🖼️ | 去除边的箭头 </h2>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/2578582/1688974334412-06ce5bff-00db-4860-b3b1-b1e1608983d8.png#averageHue=%23e8eff9&amp;clientId=u82439091-4509-4&amp;from=paste&amp;height=179&amp;id=u786afb29&amp;originHeight=268&amp;originWidth=1344&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=76101&amp;status=done&amp;style=none&amp;taskId=u0a14558e-174e-4fbf-b8a6-0334dd937ef&amp;title=&amp;width=896" alt="lQLPJwAn3bZEYW7NAQzNBUCwNtUOwPf-1RcEoUpIPACjAA_1344_268.png"></p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token literal-property property">attrs</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">line</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">stroke</span><span class="token operator">:</span> <span class="token string">'#028FA6'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">strokeWidth</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token literal-property property">targetMarker</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
          <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
          <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">8</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><h2 id="️--怎么区分-edgeremoved-事件触发原因">🖼️ | 怎么区分 edge:removed 事件触发原因 </h2>
<p>调用 <code>removeEdge</code> 或者手动删除 edge 时都会触发 <code>edge:removed</code> 事件，那怎么区分两种行为呢？在调用 <code>removeEdge</code> 的时候可以传入第二个参数 options，在 options 里面定义自己的属性，在<code>edge:remove</code> 事件参数中能获取到自定义的属性。</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code>graph<span class="token punctuation">.</span><span class="token method function property-access">removeEdge</span><span class="token punctuation">(</span>edge<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">triggerByFunction</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
graph<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">"edge:removed"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> options <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span><span class="token property-access">triggerByFunction</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 调用removeEdge删除边</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><hr>
<h2 id="️--连接桩鼠标移入显示移出隐藏">🖼️ | 连接桩鼠标移入显示/移出隐藏 </h2>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token doc-comment comment">/**
 * 显示节点上的连接桩
 * <span class="token keyword keyword-@param">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">ports</span>
 * <span class="token keyword keyword-@param">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">show</span>
 */</span>
<span class="token keyword module keyword-export">export</span> <span class="token keyword keyword-const">const</span> <span class="token function-variable function">showPorts</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ports<span class="token punctuation">,</span> show</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-let">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> ports<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ports<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">visibility</span> <span class="token operator">=</span> show <span class="token operator">?</span> <span class="token string">'visible'</span> <span class="token operator">:</span> <span class="token string">'hidden'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token comment">// 节点鼠标移入事件</span>
graph<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'node:mouseenter'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> container <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">'container'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> ports <span class="token operator">=</span> container<span class="token punctuation">.</span><span class="token method function property-access">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.x6-port-body'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">showPorts</span><span class="token punctuation">(</span>ports<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 节点鼠标离开事件</span>
graph<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'node:mouseleave'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> container <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">'container'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> ports <span class="token operator">=</span> container<span class="token punctuation">.</span><span class="token method function property-access">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.x6-port-body'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">showPorts</span><span class="token punctuation">(</span>ports<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
<span class="token comment">// 连接桩配置示例</span>
<span class="token literal-property property">groups</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token string">'top'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">attrs</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">circle</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">r</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
        <span class="token literal-property property">magnet</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">stroke</span><span class="token operator">:</span> <span class="token string">'#028FA6'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">strokeWidth</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token literal-property property">fill</span><span class="token operator">:</span> <span class="token string">'#fff'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">visibility</span><span class="token operator">:</span> <span class="token string">'hidden'</span> <span class="token comment">// 这个一定要配置！！！</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><h2 id="️--通过getnodes方法获取的节点无法获取到节点的x和y属性">🖼️ | 通过getNodes方法获取的节点无法获取到节点的x和y属性 </h2>
<h3 id="场景复现issueshttpsgithubcomantvisx6issues388">场景复现<a href="https://github.com/antvis/X6/issues/388">issues</a> </h3>
<p>这是通过<code>getNodes</code>获取到的节点实例<br>
<img src="https://cdn.nlark.com/yuque/0/2023/png/2578582/1702519476248-affe06f8-03da-4e24-895f-7a1e438563ff.png#averageHue=%23fdfcfb&amp;clientId=u845fea25-7adf-4&amp;from=paste&amp;height=426&amp;id=u81372ae5&amp;originHeight=639&amp;originWidth=739&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=51443&amp;status=done&amp;style=none&amp;taskId=u04896b38-8f51-4af3-bc7b-afa293b6165&amp;title=&amp;width=492.6666666666667" alt="image.png"></p>
<h3 id="解决方案1">解决方案1 </h3>
<p>通过<code>JSON.parse(JSON.stringify(graph.getNodes()))</code>获取，坐标放在了position对象里面<br>
<img src="https://cdn.nlark.com/yuque/0/2023/png/2578582/1702519714827-c493d2e6-64e8-432b-9762-d3ee45870665.png#averageHue=%23fdf8f8&amp;clientId=u845fea25-7adf-4&amp;from=paste&amp;height=276&amp;id=u3a5980c9&amp;originHeight=414&amp;originWidth=715&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=37428&amp;status=done&amp;style=none&amp;taskId=u29239a4b-4a60-4c7c-a788-b70f853514b&amp;title=&amp;width=476.6666666666667" alt="image.png"></p>
<h3 id="解决方案2">解决方案2 </h3>
<p>使用<code>node.toJSON()</code>方法把节点转成<code>json</code>数据</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-const">const</span> allNodes <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token method function property-access">getNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-return">return</span> item<span class="token punctuation">.</span><span class="token method function property-access">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="解决方案3">解决方案3 </h3>
<p>使用<code>node.position()</code>方法获取节点位置，然后赋值到<code>data</code>里面，后面使用的时候就可以直接从<code>data</code>里面获取</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code>  <span class="token keyword keyword-let">let</span> allNodes <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token method function property-access">getNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span>x<span class="token punctuation">,</span> y<span class="token punctuation">}</span> <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token method function property-access">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    item<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">x</span> <span class="token operator">=</span> x<span class="token punctuation">;</span>
    item<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">y</span> <span class="token operator">=</span> y<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><hr>
<h2 id="️--根据条件加载不同的配置">🖼️ | 根据条件加载不同的配置 </h2>
<p>场景来源于系统换肤，我的系统有换肤这个功能，一个是深色模式，一个是浅色模式，不同的模式要显示不同风格的节点配置，比如浅色模式下edge的颜色要为黑色，节点的图标也要换成浅色模式的……</p>
<h3 id="如何重新初始化画布">如何重新初始化画布？ </h3>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 使用计算属性获取当前系统模式（light/dark）</span>
<span class="token keyword keyword-const">const</span> getTheme <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-return">return</span> theme<span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// watch 监听主题变化重新初始化画布，initGraph 方法里面就是x6的那些七七八八的配置</span>
<span class="token function">watch</span><span class="token punctuation">(</span>theme<span class="token punctuation">,</span> <span class="token parameter">val</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">initGraph</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// if (route.query.id) {</span>
  <span class="token comment">//   getModelInfo(route.query.id);</span>
  <span class="token comment">// }</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// initGraph的方法 currentTheme就是当前监听到的主题模式</span>
<span class="token keyword keyword-const">const</span> <span class="token function-variable function">initGraph</span> <span class="token operator">=</span> <span class="token parameter">currentTheme</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-let">let</span> tempConfig <span class="token operator">=</span> currentTheme <span class="token operator">===</span> <span class="token string">'light'</span> <span class="token operator">?</span> graphConfigLight <span class="token operator">:</span> graphConfig<span class="token punctuation">;</span>
  <span class="token comment">// 这里必须要先销毁下再初始化</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>graph<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    graph<span class="token punctuation">.</span><span class="token method function property-access">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  graph <span class="token operator">=</span> <span class="token keyword null nil keyword-null">null</span><span class="token punctuation">;</span>
  graph <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Graph</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">container</span><span class="token operator">:</span> proxy<span class="token punctuation">.</span><span class="token property-access">$refs</span><span class="token punctuation">.</span><span class="token property-access">container</span><span class="token punctuation">,</span>
    <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token string">'100%'</span><span class="token punctuation">,</span>
    <span class="token spread operator">...</span>tempConfig
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 如果后面还有使用插件的地方就继续往下写</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="不通过加载画布配置">不通过加载画布配置？ </h3>
<blockquote>
<p>如果不通过重载画布的方法，那我们就不需要定义两种配置了，只需要考虑怎么把所有的节点和线的配置给更新掉就行了。这里先说一下线的更改方法，因为线更新比较简单</p>
</blockquote>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 首先你得有监听主题色变化的方法</span>
<span class="token function">watch</span><span class="token punctuation">(</span>theme<span class="token punctuation">,</span> <span class="token parameter">val</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 先获取画布上的所有线</span>
  <span class="token keyword keyword-const">const</span> edges <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token method function property-access">getEdges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 对线进行遍历，根据主题动态设置线的颜色</span>
  edges<span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    item<span class="token punctuation">.</span><span class="token method function property-access">attr</span><span class="token punctuation">(</span><span class="token string">'line/stroke'</span><span class="token punctuation">,</span> val <span class="token operator">===</span> <span class="token string">'light'</span> <span class="token operator">?</span> <span class="token string">'#4160ff'</span> <span class="token operator">:</span> <span class="token string">'#028FA6'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将边的颜色设置为红色</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><blockquote>
<p>虽然现在把画布上所有线的颜色更新了，但是还有个问题：就是从连接桩拉出来的那个线的颜色还没有改，由于这个拉出来线的配置我是写在了一个单独的配置文件中，要想改这个配置那就必须得再重新加载画布配置，那岂不是又把问题引到通过初始化画布的方法去改样式了吗？于是乎开始在社区摇人，问问别人有没有遇到过类似的问题，果然有位大佬说她大概知道我的需求</p>
</blockquote>
<p>监听从连接桩拉取线的事件，然后对这个edge进行更新颜色就行了</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code>graph<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'edge:changed'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> edge <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  edge<span class="token punctuation">.</span><span class="token method function property-access">attr</span><span class="token punctuation">(</span><span class="token string">'line/stroke'</span><span class="token punctuation">,</span> theme<span class="token punctuation">.</span><span class="token property-access">value</span> <span class="token operator">===</span> <span class="token string">'light'</span> <span class="token operator">?</span> <span class="token string">'#4160ff'</span> <span class="token operator">:</span> <span class="token string">'#028FA6'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>线的问题解决了，现在开始讲节点如何更新。我最初的想法是遍历所有的节点，然后把每一个节点data里面的图片字段更新下就行了，然后再重新渲染下节点；然而这个方法并没有奏效，反而还报错了……下面是我写的垃圾代码</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token function">watch</span><span class="token punctuation">(</span>theme<span class="token punctuation">,</span> <span class="token parameter">val</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> nodes <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token method function property-access">getNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  nodes<span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> img <span class="token punctuation">}</span> <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow keyword-if">if</span><span class="token punctuation">(</span>val <span class="token operator">===</span> <span class="token string">'light'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      item<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">img</span> <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">img</span> <span class="token operator">&amp;&amp;</span> item<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">img</span><span class="token punctuation">.</span><span class="token method function property-access">replace</span><span class="token punctuation">(</span><span class="token string">'/operator/'</span><span class="token punctuation">,</span><span class="token string">'/operator-light/'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token keyword control-flow keyword-else">else</span> <span class="token punctuation">{</span>
       item<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">img</span> <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">img</span> <span class="token operator">&amp;&amp;</span> item<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">img</span><span class="token punctuation">.</span><span class="token method function property-access">replace</span><span class="token punctuation">(</span><span class="token string">'/operator-light/'</span><span class="token punctuation">,</span><span class="token string">'/operator/'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 再重新渲染节点</span>
  graph<span class="token punctuation">.</span><span class="token method function property-access">fromJSON</span><span class="token punctuation">(</span><span class="token punctuation">{</span>nodes<span class="token punctuation">,</span>edges<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>既然不行，那就开始百度吧，于是就发现了一个新的api方法：<a href="https://x6.antv.antgroup.com/api/mvc/model#resetcells">resetCells</a>，试了之后行是行了，但是没办法更新线，更新线后也是报错，更新node又不报错……</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token function">watch</span><span class="token punctuation">(</span>theme<span class="token punctuation">,</span> <span class="token parameter">val</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> nodes <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token method function property-access">getNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  nodes<span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> img <span class="token punctuation">}</span> <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow keyword-if">if</span><span class="token punctuation">(</span>val <span class="token operator">===</span> <span class="token string">'light'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      item<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">img</span> <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">img</span> <span class="token operator">&amp;&amp;</span> item<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">img</span><span class="token punctuation">.</span><span class="token method function property-access">replace</span><span class="token punctuation">(</span><span class="token string">'/operator/'</span><span class="token punctuation">,</span><span class="token string">'/operator-light/'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token keyword control-flow keyword-else">else</span> <span class="token punctuation">{</span>
       item<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">img</span> <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">img</span> <span class="token operator">&amp;&amp;</span> item<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">img</span><span class="token punctuation">.</span><span class="token method function property-access">replace</span><span class="token punctuation">(</span><span class="token string">'/operator-light/'</span><span class="token punctuation">,</span><span class="token string">'/operator/'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 再重新渲染节点</span>
  graph<span class="token punctuation">.</span><span class="token method function property-access">resetCells</span><span class="token punctuation">(</span>nodes<span class="token punctuation">)</span><span class="token punctuation">;</span>
  graph<span class="token punctuation">.</span><span class="token method function property-access">resetCells</span><span class="token punctuation">(</span>edges<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 开始报错了</span>
  
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>最后我又把页面代码重新看了一遍，看到了之前写的一段更新节点的代码，到此才恍然大悟，自己一直想的是更新节点、更新节点、更新节点，但是就没想到用节点更新的api来做，唉……，于是就有了下面这段终极代码</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token function">watch</span><span class="token punctuation">(</span>theme<span class="token punctuation">,</span> <span class="token parameter">val</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> edges <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token method function property-access">getEdges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  edges<span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    item<span class="token punctuation">.</span><span class="token method function property-access">attr</span><span class="token punctuation">(</span><span class="token string">'line/stroke'</span><span class="token punctuation">,</span> val <span class="token operator">===</span> <span class="token string">'light'</span> <span class="token operator">?</span> <span class="token string">'#4160ff'</span> <span class="token operator">:</span> <span class="token string">'#028FA6'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将边的颜色设置为红色</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword keyword-const">const</span> nodes <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token method function property-access">getNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  nodes<span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> img <span class="token punctuation">}</span> <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-const">const</span> themeIcon <span class="token operator">=</span>
      img <span class="token operator">&amp;&amp;</span>
      img<span class="token punctuation">.</span><span class="token method function property-access">replace</span><span class="token punctuation">(</span>
        val <span class="token operator">===</span> <span class="token string">'light'</span> <span class="token operator">?</span> <span class="token string">'/operator/'</span> <span class="token operator">:</span> <span class="token string">'/operator-light/'</span><span class="token punctuation">,</span>
        val <span class="token operator">===</span> <span class="token string">'light'</span> <span class="token operator">?</span> <span class="token string">'/operator-light/'</span> <span class="token operator">:</span> <span class="token string">'/operator/'</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    item<span class="token punctuation">.</span><span class="token method function property-access">updateData</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">img</span><span class="token operator">:</span> themeIcon <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><hr>
<h2 id="️--列表渲染多个画布">🖼️ | 列表渲染多个画布 </h2>
<h3 id="场景-2">场景 </h3>
<p>问题发生的源头还是换肤，切换到浅色模式要显示浅色风格的画布和节点；如果问题到这就结束了也还好，那我直接加载不同的配置就行了，然而问题并没有如此简单……<br>
我的业务场景：在保存模型的时候，前端会顺带着一个模型的<strong>截图</strong>给后端，而这个截图的作用仅仅是列表展示使用，其它一无是处，但是换肤的时候得把这个截图换成浅色模式的截图，而且截图里面的节点也得是浅色模式的，问题到这里是不是觉得有点荒唐，是的，就是这么荒唐，此时截图已经生成保存在服务器上了，我要插上翅膀去改服务器上的资源吗？不不不~</p>
<h3 id="解决方法-4">解决方法 </h3>
<p>直接渲染多个画布，也就是说后端返回多少的列表，我这里就渲染多少个画布，不过这里要说下，每一条数据对应的节点数据要后端返回给前端，而不是前端拿着每一条记录的id去挨个查询</p>
<pre data-role="codeBlock" data-info="html" class="language-html html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>(item, index) in list<span class="token punctuation">"</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>index<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- 这个是画布容器，记得设置宽高 --&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">:id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">'</span>graph-' + item.id<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>model-img<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token doc-comment comment">/**
 * 画布初始化配置
 * <span class="token keyword keyword-@param">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">ids：这个是我从后端列表里面取的id唯一值给画布容器id赋值的</span>
 */</span>
<span class="token keyword keyword-let">let</span> allGraph <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> <span class="token function-variable function">initGraph</span> <span class="token operator">=</span> <span class="token parameter">ids</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  ids<span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-let">let</span> form <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">Graph</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">container</span><span class="token operator">:</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">'graph-'</span> <span class="token operator">+</span> item<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token string">'100%'</span><span class="token punctuation">,</span>
      <span class="token spread operator">...</span>graphConfig <span class="token comment">// 这个就是有关画布的一些基础配置</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    allGraph<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span>form<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'graph &gt;&gt;&gt;'</span><span class="token punctuation">,</span> allGraph<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// 节点渲染到对应的画布上</span>
<span class="token keyword keyword-const">const</span> <span class="token function-variable function">handleNodeData</span> <span class="token operator">=</span> <span class="token parameter">nodes</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-let">let</span> n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> n <span class="token operator">&lt;</span> nodes<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span> n<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取每一个模型对应的节点数据</span>
    <span class="token keyword keyword-const">const</span> nodeList <span class="token operator">=</span> nodes<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token property-access">nodeVoList</span><span class="token punctuation">;</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'nodeList &gt;&gt;&gt;&gt;'</span><span class="token punctuation">,</span> nodeList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-let">let</span> tempNodes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-let">let</span> tempEdges <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-let">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nodeList<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword keyword-let">let</span> item <span class="token operator">=</span> nodeList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      tempNodes<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">id</span><span class="token operator">:</span> item<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">,</span> <span class="token comment">// 节点id</span>
        <span class="token literal-property property">shape</span><span class="token operator">:</span> <span class="token string">'cu-data-node'</span><span class="token punctuation">,</span> <span class="token comment">// 自定义节点的名称</span>
        <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token known-class-name class-name">Number</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token property-access">xindex</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// x轴坐标</span>
        <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token known-class-name class-name">Number</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token property-access">yindex</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// y轴坐标</span>
        <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token comment">// 默认宽度</span>
        <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">104</span><span class="token punctuation">,</span> <span class="token comment">// 默认高度</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">name</span><span class="token operator">:</span> item<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">,</span> <span class="token comment">// 节点名称</span>
          <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment">// 数据量</span>
          <span class="token literal-property property">opType</span><span class="token operator">:</span> item<span class="token punctuation">.</span><span class="token property-access">opType</span><span class="token punctuation">,</span> <span class="token comment">// 算子类型</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> item<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">,</span> <span class="token comment">// 1数据源 2算子</span>
          <span class="token literal-property property">img</span><span class="token operator">:</span> <span class="token function">getNodeImg</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token property-access">opType</span><span class="token punctuation">)</span> <span class="token comment">// 图标</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">// 节点的连接桩</span>
        <span class="token literal-property property">ports</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token spread operator">...</span>port<span class="token punctuation">,</span>
          <span class="token literal-property property">items</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span> <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token string">'left'</span><span class="token punctuation">,</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">'port-left'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span> <span class="token literal-property property">group</span><span class="token operator">:</span> <span class="token string">'right'</span><span class="token punctuation">,</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">'port-right'</span> <span class="token punctuation">}</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 连线数据处理</span>
      <span class="token keyword keyword-let">let</span> preIds <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token property-access">preNodeIds</span> <span class="token operator">&amp;&amp;</span> item<span class="token punctuation">.</span><span class="token property-access">preNodeIds</span> <span class="token operator">!=</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        preIds <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token property-access">preNodeIds</span><span class="token punctuation">.</span><span class="token method function property-access">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword keyword-let">let</span> nextIds <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token property-access">nextNodeIds</span> <span class="token operator">&amp;&amp;</span> item<span class="token punctuation">.</span><span class="token property-access">nextNodeIds</span> <span class="token operator">!=</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        nextIds <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token property-access">nextNodeIds</span><span class="token punctuation">.</span><span class="token method function property-access">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>preIds<span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        tempEdges <span class="token operator">=</span> <span class="token known-class-name class-name">Array</span><span class="token punctuation">.</span><span class="token keyword module keyword-from">from</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>tempEdges<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token property-access">stringify</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token property-access">parse</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        preIds<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
          tempEdges<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">source</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">cell</span><span class="token operator">:</span> v<span class="token punctuation">,</span> <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token string">'port-right'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">cell</span><span class="token operator">:</span> item<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">,</span> <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token string">'port-left'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">attrs</span><span class="token operator">:</span> edgeAttrs
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>nextIds<span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        tempEdges <span class="token operator">=</span> <span class="token known-class-name class-name">Array</span><span class="token punctuation">.</span><span class="token keyword module keyword-from">from</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>tempEdges<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token property-access">stringify</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token property-access">parse</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        nextIds<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
          tempEdges<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">source</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">cell</span><span class="token operator">:</span> item<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">,</span> <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token string">'port-right'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">cell</span><span class="token operator">:</span> v<span class="token punctuation">,</span> <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token string">'port-left'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">attrs</span><span class="token operator">:</span> edgeAttrs
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      allGraph<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method function property-access">fromJSON</span><span class="token punctuation">(</span><span class="token function">useDagLayout</span><span class="token punctuation">(</span>tempNodes<span class="token punctuation">,</span> tempEdges<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// allGraph[n].fromJSON({ nodes: tempNodes, edges: tempEdges });</span>
      allGraph<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method function property-access">zoomTo</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      allGraph<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method function property-access">centerContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'处理后的节点数据 &gt;&gt;&gt;'</span><span class="token punctuation">,</span> tempNodes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'处理后的edge数据 &gt;&gt;&gt;'</span><span class="token punctuation">,</span> tempEdges<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><h3 id="截图">截图 </h3>
<h4 id="dark模式">dark模式 </h4>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/2578582/1704432574789-3ceb8fa7-d58c-44b8-a8ce-fdbf5c3351cc.png#averageHue=%23061b1f&amp;clientId=ud1bf8639-3bca-4&amp;from=paste&amp;height=177&amp;id=u4359b684&amp;originHeight=266&amp;originWidth=1210&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=26581&amp;status=done&amp;style=none&amp;taskId=uf3f77e53-75c7-4ce7-90f0-67dc21db9bd&amp;title=&amp;width=806.6666666666666" alt="image.png"></p>
<h4 id="light模式">light模式 </h4>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/2578582/1704432598876-78f502d5-6dc1-4e89-b240-7afe0bba78b8.png#averageHue=%23d2dbdc&amp;clientId=ud1bf8639-3bca-4&amp;from=paste&amp;height=182&amp;id=uc95bf276&amp;originHeight=273&amp;originWidth=1185&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=21064&amp;status=done&amp;style=none&amp;taskId=ued50bf7e-2c55-454d-bdd3-b6d99b45490&amp;title=&amp;width=790" alt="image.png"></p>
<h2 id="节点位置计算方法">节点位置计算方法 </h2>
<p><a href="https://x6.antv.vision/zh/docs/api/graph/coordinate">Coordinate</a></p>
<h2 id="自定义节点的tootip提示框">自定义节点的tootip提示框 </h2>
<h3 id="场景-3">场景 </h3>
<blockquote>
<p>终究问题原因还是某方懒的要死，本身能点开的东西，非要再搞一个预览的框，而且这个功能就是个画蛇添足般的存在。但是功能还是要做，由于每个运算节点都不一致，导致我还得拆分成不同的预览组件去展示不同节点的数据（数据格式也是不一致的）</p>
</blockquote>
<h3 id="解决方案vue3">解决方案(vue3) </h3>
<blockquote>
<p>这个方案仅演示我业务里面的，其它的应该都大同小异</p>
</blockquote>
<p>因为是多个组件，这里需要使用动态组件的标签<code>&lt;component/&gt;</code></p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token doc-comment comment">/**
showPageView：控制预览组件的显示/隐藏
pos：节点的坐标
config-data：传递给预览组件的数据
viewDom：你引入的预览页面的组件（数组类型，比如：[ViewComponent1,ViewComponent2……]）
viewCurrent：当前预览的节点(节点的类型)
viewMouseMove：监听鼠标是否移入了预览的tootip框里面了
*/</span>

<span class="token operator">&lt;</span>component
  <span class="token operator">:</span>is<span class="token operator">=</span><span class="token string">"viewDom[viewCurrent]"</span>
  v<span class="token operator">-</span><span class="token keyword control-flow keyword-if">if</span><span class="token operator">=</span><span class="token string">"showPageView"</span>
  <span class="token operator">:</span>pos<span class="token operator">=</span><span class="token string">"cardPos"</span>
  <span class="token operator">:</span>config<span class="token operator">-</span>data<span class="token operator">=</span><span class="token string">"configData"</span>
  @mousemove<span class="token operator">=</span><span class="token string">"viewMouseMove"</span>
  @mouseleave<span class="token operator">=</span>"
  showPageView <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  isMoveView <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
"<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>component<span class="token operator">&gt;</span>
</code></pre><p>节点鼠标移入移出的写法</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code>  <span class="token comment">// 节点鼠标移入事件</span>
  graph<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'node:mouseenter'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> e<span class="token punctuation">,</span> node <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-const">const</span> pos <span class="token operator">=</span> node<span class="token punctuation">.</span><span class="token method function property-access">position</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 计算当前节点的类型</span>
    viewCurrent<span class="token punctuation">.</span><span class="token property-access">value</span> <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>opType<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token comment">// 获取坐标</span>
    <span class="token keyword keyword-const">const</span> pos1 <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token method function property-access">localToPage</span><span class="token punctuation">(</span>pos<span class="token punctuation">.</span><span class="token property-access">x</span><span class="token punctuation">,</span> pos<span class="token punctuation">.</span><span class="token property-access">y</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'pos1pos1pos1  &gt;&gt;&gt;'</span><span class="token punctuation">,</span> pos1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 传递坐标数据给预览的子组件</span>
    cardPos<span class="token punctuation">.</span><span class="token property-access">value</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">left</span><span class="token operator">:</span> pos1<span class="token punctuation">.</span><span class="token property-access">x</span><span class="token punctuation">,</span> <span class="token literal-property property">top</span><span class="token operator">:</span> pos1<span class="token punctuation">.</span><span class="token property-access">y</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// 这个是传递给预览组件的数据</span>
    configData<span class="token punctuation">.</span><span class="token property-access">value</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token spread operator">...</span>operatorConfiguration <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// 移入就展示对应的tooltip</span>
    showPageView<span class="token punctuation">.</span><span class="token property-access">value</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 节点鼠标离开事件</span>
  graph<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'node:mouseleave'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 添加延时关闭，解决鼠标可以移入到tooltip提示框内部</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isMoveView<span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        showPageView<span class="token punctuation">.</span><span class="token property-access">value</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>viewMouseMove 的写法</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token doc-comment comment">/**
 * 鼠标移入预览内容区域
 */</span>
<span class="token keyword keyword-const">const</span> <span class="token function-variable function">viewMouseMove</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  isMoveView<span class="token punctuation">.</span><span class="token property-access">value</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><p>:::warning<br>
注意：以上方案是手写tooltip实现，不同分辨率下tooltip的位置可能会存在偏移，所以最稳妥的方法还是借助一些插件或者第三方的ui组件库配合vue节点的方式进行实现<br>
:::</p>
<hr>
<h2 id="自定义html节点的使用">自定义html节点的使用 </h2>
<p><a href="https://x6.antv.antgroup.com/tutorial/intermediate/html">html节点文档</a></p>
<h3 id="如何注册">如何注册？ </h3>
<ol>
<li>导入<code>Shape</code>插件</li>
</ol>
<p><code>import { Shape } from '@antv/x6'</code></p>
<ol start="2">
<li>注册html节点</li>
</ol>
<p><code>effect:['data']</code>属性的作用是监听节点的data数据变化后及时更新html的内容<br>
对于我这里为什么把节点图片地址转成base64的问题可以看下这篇文档<a href="https://www.yuque.com/sxd_panda/antv/export">传送门</a></p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code>  <span class="token comment">// 注册自定义节点 图标+标题+描述</span>
  <span class="token maybe-class-name">Shape</span><span class="token punctuation">.</span><span class="token constant">HTML</span><span class="token punctuation">.</span><span class="token method function property-access">register</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">shape</span><span class="token operator">:</span> <span class="token string">'cu-data-node'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token string">'auto'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">104</span><span class="token punctuation">,</span>
    <span class="token literal-property property">zIndex</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token literal-property property">effect</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token function">html</span><span class="token punctuation">(</span><span class="token parameter">cell</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 获取节点传递过来的数据</span>
      <span class="token keyword keyword-const">const</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> img<span class="token punctuation">,</span> desc<span class="token punctuation">,</span> opType <span class="token punctuation">}</span> <span class="token operator">=</span> cell<span class="token punctuation">.</span><span class="token method function property-access">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 创建自定义的节点容器</span>
      <span class="token keyword keyword-const">const</span> container <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      container<span class="token punctuation">.</span><span class="token method function property-access">setAttribute</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'cu-container'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 图片根据不同的类型进行切换，可以是后端返回的图标，也可以是自己本地的图标，如果是后端返回就通过节点的data传进来</span>
      <span class="token keyword keyword-const">const</span> container_img <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      container_img<span class="token punctuation">.</span><span class="token method function property-access">setAttribute</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'cu-container-img'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      container_img<span class="token punctuation">.</span><span class="token method function property-access">setAttribute</span><span class="token punctuation">(</span><span class="token string">'alt'</span><span class="token punctuation">,</span> <span class="token string">'节点ico'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      container_img<span class="token punctuation">.</span><span class="token property-access">style</span><span class="token punctuation">.</span><span class="token property-access">cursor</span> <span class="token operator">=</span> <span class="token string">'pointer'</span><span class="token punctuation">;</span>
      <span class="token comment">// 先用远程图片地址给图片的src赋值，然后再重新赋值成base64的格式；这么做的目的就是解决节点拖拽到画布上会出现短暂的边框闪动问题，如果你要复现这个边框，可以把下面这一行代码注掉（不是必现）</span>
      <span class="token comment">// const icon = img ? img : remoteImgUrl.value;</span>
      container_img<span class="token punctuation">.</span><span class="token property-access">src</span> <span class="token operator">=</span> img<span class="token punctuation">;</span>
      <span class="token comment">// 把图片转成base64方便存储到后端</span>
      <span class="token maybe-class-name">DataUri</span><span class="token punctuation">.</span><span class="token method function property-access">imageToDataUri</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token keyword keyword-function">function</span> <span class="token punctuation">(</span><span class="token parameter">nu<span class="token punctuation">,</span> url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 第一个参数无效，用的只是第二个参数，但是第一个参数不写由不行</span>
        container_img<span class="token punctuation">.</span><span class="token property-access">src</span> <span class="token operator">=</span> url<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// container_img.src = img ? img : `${import.meta.env.VITE_IMG_PREFIX}/zfc-images/operator/datasouce.png`;</span>

      <span class="token keyword keyword-const">const</span> container_title <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      container_title<span class="token punctuation">.</span><span class="token property-access">innerText</span> <span class="token operator">=</span> name<span class="token punctuation">;</span>
      container_title<span class="token punctuation">.</span><span class="token method function property-access">setAttribute</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'cu-container-title'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>name<span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">&gt;</span> <span class="token number">5</span><span class="token punctuation">)</span> container_title<span class="token punctuation">.</span><span class="token method function property-access">setAttribute</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword keyword-const">const</span> container_desc <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      container_desc<span class="token punctuation">.</span><span class="token method function property-access">setAttribute</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'cu-container-desc'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 算子配置不需要描述信息</span>
      container_desc<span class="token punctuation">.</span><span class="token property-access">innerText</span> <span class="token operator">=</span> opType <span class="token operator">===</span> <span class="token string">''</span> <span class="token operator">?</span> <span class="token string">'(共'</span> <span class="token operator">+</span> desc <span class="token operator">+</span> <span class="token string">'条)'</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">;</span>

      container<span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span>container_img<span class="token punctuation">)</span><span class="token punctuation">;</span>
      container<span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span>container_title<span class="token punctuation">)</span><span class="token punctuation">;</span>
      container<span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span>container_desc<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword control-flow keyword-return">return</span> container<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="如何使用">如何使用？ </h3>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code>  <span class="token keyword keyword-const">const</span> node <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token method function property-access">createNode</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">shape</span><span class="token operator">:</span> <span class="token string">'cu-data-node'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
    <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">104</span><span class="token punctuation">,</span>
    <span class="token literal-property property">label</span><span class="token operator">:</span> data<span class="token operator">?.</span>name<span class="token punctuation">,</span>
    <span class="token literal-property property">id</span><span class="token operator">:</span> data<span class="token operator">?.</span>id<span class="token punctuation">,</span>
    <span class="token comment">// 所有节点的数据源头都在这里设置，需要哪些字段自行添加即可</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> data<span class="token operator">?.</span>name<span class="token punctuation">,</span> <span class="token comment">// 节点的名称</span>
      <span class="token literal-property property">img</span><span class="token operator">:</span> data<span class="token operator">?.</span>img <span class="token operator">||</span> remoteImgUrl<span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">,</span> <span class="token comment">// 图标</span>
      <span class="token literal-property property">desc</span><span class="token operator">:</span> data<span class="token operator">?.</span>dataNum <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 总数据描述</span>
      ……
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token doc-comment comment">/**
     * 连接桩位置判断逻辑
     * 1、数据源类型的连接桩只显示右侧
     * 2、算子类型的连接桩显示左右两侧
     * 3、算子类型-关联回填的连接桩显示左侧
     */</span>
    <span class="token literal-property property">ports</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token spread operator">...</span>port
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><hr>
<h2 id="自定义vue节点的使用">自定义vue节点的使用 </h2>
<p><a href="https://x6.antv.antgroup.com/tutorial/intermediate/vue">vue节点文档</a></p>
<blockquote>
<p>本篇文档只讲解vue3中如何使用，vue2的可以参考下官方文档</p>
</blockquote>
<h3 id="安装插件">安装插件 </h3>
<p><code>@antv/x6-vue-shape</code></p>
<h3 id="添加vue组件">添加vue组件 </h3>
<blockquote>
<p>既然使用vue节点，那么我们就需要准备一个vue的组件，这个组件就是节点的一些样式，根据你们的ui自行写代码即可</p>
</blockquote>
<pre data-role="codeBlock" data-info="vue" class="language-vue vue"><code>&lt;template&gt;
  &lt;div&gt;节点名称&lt;/div&gt;
  &lt;div&gt;节点描述&lt;/div&gt;
  ……
&lt;/template&gt;
</code></pre><h3 id="注册vue节点">注册vue节点 </h3>
<ol>
<li>导入vue节点注册插件</li>
</ol>
<p><code>import { register, getTeleport } from '@antv/x6-vue-shape';</code></p>
<ol start="2">
<li>注册节点</li>
</ol>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">shape</span><span class="token operator">:</span> <span class="token string">'custom-vue-node'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token string">'auto'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">104</span><span class="token punctuation">,</span>
  <span class="token literal-property property">component</span><span class="token operator">:</span> vueNode <span class="token comment">// 这个就是你定义的vue组件</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><ol start="3">
<li>添加传送门</li>
</ol>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword module keyword-import">import</span> <span class="token imports"><span class="token punctuation">{</span> getTeleport <span class="token punctuation">}</span></span> <span class="token keyword module keyword-from">from</span> <span class="token string">'@antv/x6-vue-shape'</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> <span class="token maybe-class-name">TeleportContainer</span> <span class="token operator">=</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token function">getTeleport</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// template 中添加标签，和你的画布容器平级</span>
<span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"graphDom"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token maybe-class-name">TeleportContainer</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre><ol start="4">
<li>使用</li>
</ol>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code>  <span class="token keyword keyword-const">const</span> node <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token method function property-access">createNode</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">shape</span><span class="token operator">:</span> <span class="token string">'custom-vue-node'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
    <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">104</span><span class="token punctuation">,</span>
    <span class="token literal-property property">label</span><span class="token operator">:</span> data<span class="token operator">?.</span>name<span class="token punctuation">,</span>
    <span class="token literal-property property">id</span><span class="token operator">:</span> data<span class="token operator">?.</span>id<span class="token punctuation">,</span>
    <span class="token comment">// 所有节点的数据源头都在这里设置，需要哪些字段自行添加即可</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> data<span class="token operator">?.</span>name<span class="token punctuation">,</span> <span class="token comment">// 节点的名称</span>
      <span class="token literal-property property">img</span><span class="token operator">:</span> data<span class="token operator">?.</span>img <span class="token operator">||</span> remoteImgUrl<span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">,</span> <span class="token comment">// 图标</span>
      <span class="token literal-property property">desc</span><span class="token operator">:</span> data<span class="token operator">?.</span>dataNum <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 总数据描述</span>
      ……
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token doc-comment comment">/**
     * 连接桩位置判断逻辑
     * 1、数据源类型的连接桩只显示右侧
     * 2、算子类型的连接桩显示左右两侧
     * 3、算子类型-关联回填的连接桩显示左侧
     */</span>
    <span class="token literal-property property">ports</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token spread operator">...</span>port
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="节点内部监听数据变化">节点内部监听数据变化 </h3>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-const">const</span> getNodeData <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'getNode'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> currentNode <span class="token operator">=</span> <span class="token function">getNodeData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 监听当前节点数据发生了变化</span>
  currentNode<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'change:data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> current <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'节点数据是否发生变化了 &gt;&gt;&gt;'</span><span class="token punctuation">,</span> current<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><h3 id="vue节点拖拽的时候报错">vue节点拖拽的时候报错？ </h3>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/2578582/1715161582677-71762bbd-ddeb-425c-870f-da649b480e2d.png#averageHue=%23fbf0d9&amp;clientId=ueef1645c-9ec3-4&amp;from=paste&amp;height=494&amp;id=u030e6c88&amp;originHeight=741&amp;originWidth=1422&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=164899&amp;status=done&amp;style=none&amp;taskId=u92889cff-a972-4350-8e4f-53cb48f31b2&amp;title=&amp;width=948" alt="image.png"><br>
检查你的vue组件是否是这种结构</p>
<pre data-role="codeBlock" data-info="html" class="language-html html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>内容：{{ dataNode.name }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>n-badge</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>n-avatar</span> <span class="token attr-name">:src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>vueIco<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>n-avatar</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>n-badge</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>需要改成下面这种的结构(需要用根节点进行包裹)</p>
<pre data-role="codeBlock" data-info="html" class="language-html html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>内容：{{ dataNode.name }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>n-badge</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>n-avatar</span> <span class="token attr-name">:src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>vueIco<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>n-avatar</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>n-badge</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><hr>
<h2 id="节点事件和vue节点内的click事件冲突问题">节点事件和vue节点内的click事件冲突问题 </h2>
<h3 id="场景-4">场景 </h3>
<blockquote>
<p>因为我用的是vue类型的节点，所以这里就按照vue节点来进行讲解，其它的节点(React、Angular、Html)这些都是通用的。</p>
</blockquote>
<blockquote>
<p>在vue节点内部的某个元素上需要执行一个点击事件，但是在执行本事件的时候不能去触发<code>node:click</code>的事件、在执行<code>node:click</code>事件的时候不能触发vue节点的点击事件，也就是两边的事件都是独立的，谁也不能影响谁，而且vue节点内的点击事件在点击的时候还得获取当前节点信息</p>
</blockquote>
<h3 id="踩坑方案1">踩坑方案1 </h3>
<p>直接给vue的点击事件添加<code>stop</code>修饰符，阻止事件传递，然后在<code>node:click</code>的时候再阻止下，但是结果下来确是不行……</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// vue节点的事件</span>
@click<span class="token punctuation">.</span><span class="token property-access">stop</span> <span class="token operator">=</span> test

<span class="token comment">// 父页面的节点节点事件</span>
graph<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'node:click'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>e<span class="token punctuation">}</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  e<span class="token punctuation">.</span><span class="token method function property-access">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><h3 id="踩坑方案2">踩坑方案2 </h3>
<p>采用群里小伙伴的方案，阻止节点鼠标按下或者鼠标抬起的事件，这样可以实现在点击vue节点的时候不触发节点本身的<code>node:click</code>事件，虽然可以实现阻止的功能，但是不好操作节点的数据，我是需要获取当前节点的数据的</p>
<h3 id="终极解决方案">终极解决方案 </h3>
<p>通过获取click事件的点击区域进行判断，如果是点击了vue节点内的点击事件区域，就直接在node:click的时候阻止掉就行了</p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code>graph<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'node:click'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>e<span class="token punctuation">}</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 判断target的className或者id，或者你定义的一些自定义属性，</span>
  <span class="token comment">// 反正只要你能知道当前点击的区域是属于谁的就行</span>
  <span class="token comment">// 我在vue节点点击事件的标签上加了个class</span>
  <span class="token keyword control-flow keyword-if">if</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">className</span> <span class="token operator">==</span> <span class="token string">'cu-class'</span><span class="token punctuation">)</span> <span class="token keyword control-flow keyword-return">return</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><hr>
<h2 id="vue节点数据如何反向传递给父组件vue3">vue节点数据如何反向传递给父组件(vue3)？ </h2>
<p>提的issues：<a href="https://github.com/antvis/X6/issues/4323">https://github.com/antvis/X6/issues/4323</a> （这里面有vue2的解决方案）</p>
<blockquote>
<p>这个问题还待解决，官方暂时没有任何答复，短期内只能根据我的业务需求用野路子实现，如果有其它的可以留言你的需求</p>
</blockquote>
<h3 id="场景-5">场景 </h3>
<p>vue节点内部有一个复选框，用于勾选节点，选中后要给当前节点添加一个是否选中的属性，由于节点的数据更新只能在父页面进行更新，所以必须得把复选框绑定的值传递给父页面</p>
<h3 id="解决方案1-1">解决方案1 </h3>
<blockquote>
<p>这个方案属于野路子，不是很灵活，如果不是复选框那基本凉凉了</p>
</blockquote>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token comment">// vue节点内正常写复选框绑定的逻辑</span>
<span class="token keyword keyword-const">const</span> checked2 <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span>el<span class="token operator">-</span>checkbox v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"checked2"</span> size<span class="token operator">=</span><span class="token string">"large"</span> @change<span class="token operator">=</span><span class="token string">"checkChange"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>checkbox<span class="token operator">&gt;</span>



<span class="token comment">// 父组件监听节点的点击事件</span>
graph<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'node:click'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>e<span class="token punctuation">,</span>node<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-let">let</span> state <span class="token operator">=</span> node<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">checkState</span> <span class="token operator">??</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token comment">// 这个判断是为了解决复选框的点击事件和节点的点击事件冲突的问题</span>
    <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">className</span> <span class="token operator">==</span> <span class="token string">'el-checkbox__inner'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 给节点添加一个checkState属性，标识是否选中</span>
      node<span class="token punctuation">.</span><span class="token method function property-access">updateData</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">checkState</span><span class="token operator">:</span> <span class="token operator">!</span>state <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">ignoreHistory</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow keyword-return">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


<span class="token comment">// 最后点击保存按钮的时候获取下节点checkState为true的数据</span>
<span class="token keyword keyword-const">const</span> <span class="token function-variable function">save</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword keyword-const">const</span> allNodes <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token method function property-access">getNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 我这里是取的id属性，如果你们需要其它的可以自行组装</span>
  checkedOps<span class="token punctuation">.</span><span class="token property-access">value</span> <span class="token operator">=</span> allNodes<span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=&gt;</span> item<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">checkState</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=&gt;</span> item<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'checkedOps &gt;&gt;&gt;'</span><span class="token punctuation">,</span> checkedOps<span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre><h3 id="解决方案2-1">解决方案2 </h3>
<blockquote>
<p>这个方案就可以随便玩了，不再局限于我自己的需求，如果还要在节点上加其它的控件都可以完美的把数据传递到父组件，其灵感来源于github的小伙伴<a href="https://github.com/qw123gz">qw123gz</a>，问官方交流群的群主，问了半天也没有给出方案……</p>
</blockquote>
<h4 id="子组件添加emit事件">子组件添加emit事件 </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token operator">&lt;</span>el<span class="token operator">-</span>checkbox v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"checked2"</span> size<span class="token operator">=</span><span class="token string">"large"</span> @change<span class="token operator">=</span><span class="token string">"checkChange"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>checkbox<span class="token operator">&gt;</span>


<span class="token keyword keyword-const">const</span> checked2 <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> emits <span class="token operator">=</span> <span class="token function">defineEmits</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'getCheckVal'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> <span class="token function-variable function">checkChange</span> <span class="token operator">=</span> <span class="token parameter">val</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">emits</span><span class="token punctuation">(</span><span class="token string">'getCheckVal'</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><h4 id="父组件改造注册vue节点的代码">父组件改造注册vue节点的代码 </h4>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">shape</span><span class="token operator">:</span> <span class="token string">'custom-vue-node'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token string">'auto'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">104</span><span class="token punctuation">,</span>
  <span class="token comment">// component: vueNode   这个是官方提供的注册方式</span>
  <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 使用vue3的render渲染组件，并添加自定义事件</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow keyword-return">return</span> <span class="token function">h</span><span class="token punctuation">(</span>vueNode<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token comment">// 事件名称前面必须添加 `on`</span>
        <span class="token function-variable function">onGetCheckVal</span><span class="token operator">:</span> <span class="token parameter">val</span> <span class="token arrow operator">=&gt;</span> <span class="token function">getMyCheckVal</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>至此，数据反向传递就完成了，至于怎么使用传递过来的数据就看你们的业务需求了</p>
<hr>
<h2 id="vue节点内如何获取画布实例">vue节点内如何获取画布实例？ </h2>
<blockquote>
<p>有的场景下我们可能需要在vue子组件内拿到画布的实例，如果靠从父组件传递下来，可能不太明智，其实翻看@antv/x6-vue-shape的源码就可以发现它暴露两个provide，一个是官方文档提到的getNode，另外一个就是getGraph</p>
</blockquote>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/2578582/1716797520130-fe02519a-7b2e-4416-b2ba-0bb00643e6ee.png#averageHue=%2320201f&amp;clientId=ud362e5ff-2428-4&amp;from=paste&amp;height=445&amp;id=u3fc11a4d&amp;originHeight=668&amp;originWidth=958&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=72684&amp;status=done&amp;style=none&amp;taskId=u19cfd14c-df67-4665-81b9-c98e795e5ec&amp;title=&amp;width=638.6666666666666" alt="image.png"></p>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-const">const</span> getNodeData <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'getNode'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-const">const</span> getGra <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'getGraph'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h2 id="框选如何添加过滤条件">框选如何添加过滤条件？ </h2>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code>graph<span class="token punctuation">.</span><span class="token method function property-access">setSelectionFilter</span><span class="token punctuation">(</span><span class="token parameter">node</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow keyword-return">return</span> node<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">.</span><span class="token property-access">checkState</span> <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><hr>
<h2 id="️--常用方法集锦">🖼️ | 常用方法集锦 </h2>
<ol>
<li>清空画布：<code>graph.clearCells()</code></li>
<li>画布缩小：<code>graph.zoom(-0.5)</code></li>
<li>获取画布缩放比例：<code>graph.zoom()</code></li>
<li>获取画布上所有节点：<code>graph.getNodes()</code></li>
<li>获取画布上所有边：<code>graph.getEdges()</code></li>
<li>设置节点移动范围在画布内<a href="https://antv-x6.gitee.io/zh/docs/api/graph/transform/#translating">链接</a></li>
</ol>
<pre data-role="codeBlock" data-info="json" class="language-json json"><code>translating<span class="token operator">:</span> <span class="token punctuation">{</span>
  restrict<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><ol start="7">
<li>动态设置节点位置<a href="https://antv-x6.gitee.io/zh/docs/api/model/node#position-1">链接</a>：<code>node.position(x,y)</code></li>
<li>节点只能被相同的源节点连接一次<a href="https://antv-x6.gitee.io/zh/docs/tutorial/basic/interacting#allowmulti">链接</a>：<code>allowMulti: false</code></li>
<li>两个节点连接的时候获取目标节点的数据<a href="https://antv-x6.gitee.io/zh/docs/tutorial/intermediate/events#%E8%BE%B9%E8%BF%9E%E6%8E%A5%E5%8F%96%E6%B6%88%E8%BF%9E%E6%8E%A5">链接</a></li>
</ol>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code>graph<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'edge:connected'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> isNew<span class="token punctuation">,</span> edge<span class="token punctuation">,</span> currentCell <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 回调的参数：https://antv-x6.gitee.io/zh/docs/tutorial/intermediate/events/#%E8%BE%B9%E8%BF%9E%E6%8E%A5%E5%8F%96%E6%B6%88%E8%BF%9E%E6%8E%A5</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'被连接的节点详细参数'</span><span class="token punctuation">,</span> currentCell<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow keyword-if">if</span> <span class="token punctuation">(</span>currentCell<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    proxy<span class="token punctuation">.</span><span class="token property-access">$modal</span><span class="token punctuation">.</span><span class="token method function property-access">msgError</span><span class="token punctuation">(</span><span class="token string">'数据源无法作为输出节点'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 移除连接的边</span>
    graph<span class="token punctuation">.</span><span class="token method function property-access">removeEdge</span><span class="token punctuation">(</span>edge<span class="token operator">?.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><ol start="10">
<li>判断当前节点是否被连接<a href="https://antv-x6.gitee.io/zh/docs/api/graph/model#getconnectededges">链接</a></li>
</ol>
<pre data-role="codeBlock" data-info="javascript" class="language-javascript javascript"><code><span class="token keyword keyword-const">const</span> node <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token method function property-access">getCellById</span><span class="token punctuation">(</span><span class="token string">'node1'</span><span class="token punctuation">)</span>
<span class="token keyword keyword-const">const</span> connectedEdges <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token method function property-access">getConnectedEdges</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>
</code></pre><ol start="11">
<li>根据边获取节点：<code>edge.getSourceNode();</code></li>
<li>节点实例转json：<code>node.toJSON()</code></li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2023/jpeg/2578582/1686119457435-59195b9d-534e-47c0-9d4b-266bccc5d638.jpeg#averageHue=%23fbfbfa&amp;clientId=u86232ec9-518c-4&amp;from=paste&amp;height=23&amp;id=u60a46656&amp;originHeight=34&amp;originWidth=1280&amp;originalType=binary&amp;ratio=1.5&amp;rotation=0&amp;showTitle=false&amp;size=4234&amp;status=done&amp;style=none&amp;taskId=ua82c9a7e-a8b4-4064-bf5b-c50965b1dee&amp;title=&amp;width=853.3333333333334" alt="7b49173b21c936862b568f83c1dae9a.jpg"></p>
<p><a href="https://x6.antv.antgroup.com/tutorial/plugins/dnd">Dnd插件</a><br>
<a href="https://x6.antv.antgroup.com/tutorial/plugins/stencil">Stencil插件</a><br>
<a href="https://x6.antv.antgroup.com/tutorial/plugins/export">图片导出</a><br>
<a href="https://antv-x6.gitee.io/zh/docs/tutorial/epilog#%E5%AF%BC%E5%87%BA%E5%9B%BE%E7%89%87%E6%A0%B7%E5%BC%8F%E7%BC%BA%E5%A4%B1">1.x常见问题</a><br>
<a href="https://antv-x6.gitee.io/zh/docs/tutorial/log#19x">坐标转换</a><br>
<a href="https://antv-x6.gitee.io/zh/docs/api/graph/transform/#translating">Transform</a><br>
<a href="https://antv-x6.gitee.io/zh/docs/api/graph/model/#getconnectededges">Model</a><br>
<a href="https://antv-x6.gitee.io/zh/docs/api/graph/model/#getsuccessors">getSuccessors</a><br>
<a href="https://daizhigitee.gitee.io/x6-vue3-components/">X6 Vue3 Components</a><br>
<a href="https://sxdpanda.gitee.io/antv-admin/">自定义拖拽demo</a></p>
<hr>
<p><a href="https://www.yuque.com/sxd_panda/antv/dnd?view=doc_embed">「AntV」x6 自定义拖拽</a> | <a href="https://www.yuque.com/sxd_panda/antv/selection?view=doc_embed">「AntV」x6 框选添加右键菜单</a> | <a href="https://www.yuque.com/sxd_panda/antv/export?view=doc_embed">「AntV」x6 图片导出问题汇总</a> | <a href="https://www.yuque.com/sxd_panda/antv/html-node?view=doc_embed">「AntV」X6 自定义html节点</a> | <a href="https://www.yuque.com/sxd_panda/antv/vue-node?view=doc_embed">「AntV」X6 自定义vue节点(vue3)</a></p>
<hr>
<p><a href="https://sxdpanda.gitee.io/graph-visualization/#/index">关系图谱（国内镜像）</a><br>
<a href="https://zlecheng.github.io/atlas-pages/#/index">关系图谱（备用地址）</a><br>
<a href="https://zlecheng.github.io/antv-page/#/home">AntV x6 自定义拖拽demo</a><br>
<a href="https://mp.weixin.qq.com/s/IGIjKjMMxaLvnimXbX5YDg">AntV X6开发实践：踩过的坑与解决方案</a></p>
<p><img src="https://cdn.nlark.com/yuque/0/2023/webp/2578582/1702559928278-65460ac2-56fb-4629-a341-a9f10e76e8ec.webp#averageHue=%23181614&amp;clientId=ub724a9d6-9de2-4&amp;from=paste&amp;height=102&amp;id=Uka4m&amp;originHeight=127&amp;originWidth=341&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=6318&amp;status=done&amp;style=none&amp;taskId=uc8e7c8c7-462b-4546-bd47-5cd60f690d1&amp;title=&amp;width=272.8" alt="111.webp"></p>

      </div>
      
      
    
    
    
    
    
    
  
    </body></html>